<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Vocabulary Match-Up Adventure</title>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Segoe+UI:wght@400;500;600;700&display=swap');

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.4) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 177, 153, 0.4) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #533483 75%, #7209b7 100%);
            min-height: 100vh;
            color: white;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><radialGradient id="star" cx="50%" cy="50%" r="50%"><stop offset="0%" style="stop-color:white;stop-opacity:0.8"/><stop offset="100%" style="stop-color:white;stop-opacity:0"/></radialGradient></defs><circle cx="20" cy="30" r="1" fill="url(%23star)"/><circle cx="80" cy="20" r="0.5" fill="url(%23star)"/><circle cx="60" cy="70" r="0.8" fill="url(%23star)"/><circle cx="30" cy="80" r="0.6" fill="url(%23star)"/><circle cx="90" cy="60" r="0.4" fill="url(%23star)"/><circle cx="10" cy="60" r="0.7" fill="url(%23star)"/><circle cx="70" cy="40" r="0.3" fill="url(%23star)"/><circle cx="40" cy="10" r="0.9" fill="url(%23star)"/></svg>') repeat,
                linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.02) 50%, transparent 70%);
            animation: twinkle 8s ease-in-out infinite, drift 20s linear infinite;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        @keyframes drift {
            0% { transform: translateX(0) translateY(0); }
            25% { transform: translateX(-10px) translateY(-5px); }
            50% { transform: translateX(5px) translateY(-10px); }
            75% { transform: translateX(-5px) translateY(5px); }
            100% { transform: translateX(0) translateY(0); }
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-family: 'Cinzel', serif;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: #ffd700;
            text-shadow: 
                0 0 10px rgba(255, 215, 0, 0.8),
                0 0 20px rgba(255, 215, 0, 0.6),
                0 0 30px rgba(255, 215, 0, 0.4),
                2px 2px 4px rgba(0,0,0,0.5);
            letter-spacing: 2px;
        }



        .game-stats {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: center;
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .timer-section {
            text-align: center;
            position: relative;
        }

        .timer-circle {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: conic-gradient(#ff4757 0deg, #ff4757 0deg, rgba(255,255,255,0.2) 0deg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            position: relative;
            transition: background 0.1s ease;
        }

        .timer-text {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
        }

        .combo-display {
            position: absolute;
            top: -10px;
            right: -10px;
            background: linear-gradient(45deg, #feca57, #ff9ff3);
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
            transform: scale(0);
            transition: transform 0.3s ease;
        }

        .combo-display.active {
            transform: scale(1);
            animation: pulse-combo 0.5s ease;
        }

        @keyframes pulse-combo {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        .character-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .character-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border: 3px solid white;
            overflow: hidden;
        }

        .character-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .level-info {
            text-align: left;
        }

        .level-info h3 {
            margin-bottom: 5px;
        }

        .xp-bar {
            width: 200px;
            height: 10px;
            background: rgba(255,255,255,0.2);
            border-radius: 5px;
            overflow: hidden;
        }

        .xp-fill {
            height: 100%;
            background: linear-gradient(90deg, #00d2ff, #3a7bd5);
            transition: width 0.5s ease;
            border-radius: 5px;
        }

        .monster-info {
            text-align: center;
        }

        .monster-avatar {
            width: 80px;
            height: 80px;
            background: linear-gradient(45deg, #ff4757, #c44569);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            margin: 0 auto 10px;
            border: 3px solid #ff6b6b;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .hp-bar {
            width: 150px;
            height: 8px;
            background: rgba(255,255,255,0.2);
            border-radius: 4px;
            overflow: hidden;
            margin: 0 auto;
        }

        .hp-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4757, #ff3838);
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .game-board {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .card-section {
            background: rgba(255,255,255,0.1);
            padding: 25px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }

        .card-section h3 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .card {
            background: white;
            color: #333;
            padding: 20px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-weight: 500;
            border: 3px solid transparent;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .card.selected {
            border-color: #3a7bd5;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-5px);
        }

        .card.matched {
            background: linear-gradient(135deg, #56ab2f, #a8e6cf);
            color: white;
            border-color: #56ab2f;
            cursor: default;
            opacity: 0.7;
            animation: epic-success 0.8s ease-out;
        }

        .card.wrong {
            background: linear-gradient(135deg, #ff4757, #ff3838);
            color: white;
            border-color: #ff4757;
            animation: shake 0.5s ease-in-out;
        }

        .card.hint {
            background: linear-gradient(135deg, #feca57, #ff9ff3);
            color: white;
            border-color: #feca57;
            animation: glow 1s ease-in-out infinite alternate;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10% { transform: translateX(-10px) rotate(-1deg); }
            20% { transform: translateX(10px) rotate(1deg); }
            30% { transform: translateX(-8px) rotate(-1deg); }
            40% { transform: translateX(8px) rotate(1deg); }
            50% { transform: translateX(-6px) rotate(-0.5deg); }
            60% { transform: translateX(6px) rotate(0.5deg); }
            70% { transform: translateX(-4px) rotate(-0.5deg); }
            80% { transform: translateX(4px) rotate(0.5deg); }
            90% { transform: translateX(-2px); }
        }

        @keyframes glow {
            0% { box-shadow: 0 0 10px rgba(254, 202, 87, 0.5); }
            100% { box-shadow: 0 0 20px rgba(254, 202, 87, 0.8); }
        }

        @keyframes epic-success {
            0% { 
                transform: scale(1) rotate(0deg);
                box-shadow: 0 0 10px rgba(86, 171, 47, 0.5);
            }
            25% { 
                transform: scale(1.1) rotate(2deg);
                box-shadow: 0 0 25px rgba(86, 171, 47, 0.8);
            }
            50% { 
                transform: scale(1.15) rotate(-1deg);
                box-shadow: 0 0 35px rgba(86, 171, 47, 1);
            }
            75% { 
                transform: scale(1.05) rotate(1deg);
                box-shadow: 0 0 30px rgba(86, 171, 47, 0.9);
            }
            100% { 
                transform: scale(1) rotate(0deg);
                box-shadow: 0 0 15px rgba(86, 171, 47, 0.6);
            }
        }

        @keyframes screen-flash {
            0% { background: rgba(255, 255, 255, 0); }
            50% { background: rgba(255, 255, 255, 0.3); }
            100% { background: rgba(255, 255, 255, 0); }
        }

        @keyframes screen-slash {
            0% { 
                transform: translateX(-100%);
                opacity: 0;
            }
            50% { 
                transform: translateX(0%);
                opacity: 1;
            }
            100% { 
                transform: translateX(100%);
                opacity: 0;
            }
        }

        @keyframes damage-pulse {
            0% { 
                transform: scale(1);
                filter: hue-rotate(0deg) brightness(1);
            }
            25% { 
                transform: scale(0.95);
                filter: hue-rotate(180deg) brightness(1.5);
            }
            50% { 
                transform: scale(1.05);
                filter: hue-rotate(360deg) brightness(0.8);
            }
            75% { 
                transform: scale(0.98);
                filter: hue-rotate(180deg) brightness(1.2);
            }
            100% { 
                transform: scale(1);
                filter: hue-rotate(0deg) brightness(1);
            }
        }

        @keyframes level-up-burst {
            0% { 
                transform: scale(0.5) rotate(0deg);
                opacity: 0;
                filter: brightness(2);
            }
            50% { 
                transform: scale(1.3) rotate(180deg);
                opacity: 1;
                filter: brightness(3);
            }
            100% { 
                transform: scale(1) rotate(360deg);
                opacity: 1;
                filter: brightness(1);
            }
        }

        @keyframes power-up-activate {
            0% { 
                transform: scale(1);
                box-shadow: 0 0 10px rgba(102, 126, 234, 0.5);
            }
            25% { 
                transform: scale(1.2);
                box-shadow: 0 0 30px rgba(102, 126, 234, 1);
            }
            50% { 
                transform: scale(1.1);
                box-shadow: 0 0 40px rgba(102, 126, 234, 1);
            }
            75% { 
                transform: scale(1.15);
                box-shadow: 0 0 35px rgba(102, 126, 234, 0.8);
            }
            100% { 
                transform: scale(1);
                box-shadow: 0 0 20px rgba(102, 126, 234, 0.6);
            }
        }

        @keyframes particle-burst {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(
                    calc(cos(var(--angle)) * var(--distance)),
                    calc(sin(var(--angle)) * var(--distance))
                ) scale(0);
                opacity: 0;
            }
        }

        @keyframes monster-damage {
            0% { transform: translateX(0); filter: brightness(1); }
            25% { transform: translateX(-15px); filter: brightness(1.5) hue-rotate(180deg); }
            50% { transform: translateX(15px); filter: brightness(0.7) hue-rotate(360deg); }
            75% { transform: translateX(-10px); filter: brightness(1.3) hue-rotate(90deg); }
            100% { transform: translateX(0); filter: brightness(1); }
        }

        @keyframes critical-hit {
            0% { 
                transform: scale(1) rotate(0deg);
                filter: brightness(1);
            }
            25% { 
                transform: scale(1.3) rotate(5deg);
                filter: brightness(2) saturate(2);
            }
            50% { 
                transform: scale(1.2) rotate(-3deg);
                filter: brightness(1.8) saturate(1.5);
            }
            75% { 
                transform: scale(1.1) rotate(2deg);
                filter: brightness(1.5) saturate(1.2);
            }
            100% { 
                transform: scale(1) rotate(0deg);
                filter: brightness(1);
            }
        }

        @keyframes boss-defeat {
            0% { 
                transform: scale(1) rotate(0deg);
                opacity: 1;
                filter: brightness(1) hue-rotate(0deg);
            }
            25% { 
                transform: scale(1.2) rotate(-10deg);
                opacity: 0.8;
                filter: brightness(2) hue-rotate(180deg);
            }
            50% { 
                transform: scale(0.8) rotate(15deg);
                opacity: 0.6;
                filter: brightness(0.5) hue-rotate(360deg);
            }
            75% { 
                transform: scale(1.1) rotate(-5deg);
                opacity: 0.3;
                filter: brightness(3) hue-rotate(540deg);
            }
            100% { 
                transform: scale(0) rotate(720deg);
                opacity: 0;
                filter: brightness(0) hue-rotate(720deg);
            }
        }

        @keyframes boss-dissolve {
            0% { 
                transform: scale(1);
                filter: brightness(1) blur(0px);
                box-shadow: 0 0 20px rgba(255, 71, 87, 0.3);
            }
            30% { 
                transform: scale(1.05);
                filter: brightness(1.3) blur(1px);
                box-shadow: 0 0 40px rgba(255, 215, 0, 0.6);
            }
            70% { 
                transform: scale(0.95);
                filter: brightness(0.7) blur(3px);
                box-shadow: 0 0 60px rgba(255, 215, 0, 0.4);
            }
            100% { 
                transform: scale(1);
                filter: brightness(1.2) blur(0px);
                box-shadow: 0 0 30px rgba(255, 215, 0, 0.2);
            }
        }

        .power-ups {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .power-up-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .power-up-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .power-up-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .power-up-btn .cooldown {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: rgba(0,0,0,0.3);
            transition: width 0.1s ease;
        }

        .streak-display {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #feca57, #ff9ff3);
            color: white;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 1.5rem;
            font-weight: bold;
            z-index: 999;
            opacity: 0;
            transform: translate(-50%, -50%) scale(0);
            transition: all 0.5s ease;
        }

        .streak-display.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .feedback {
            text-align: center;
            margin: 20px 0;
            font-size: 1.2rem;
            font-weight: bold;
            min-height: 30px;
        }

        .feedback.success {
            color: #56ab2f;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .feedback.error {
            color: #ff4757;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }



        .victory-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .victory-content {
            background: linear-gradient(135deg, #667eea, #764ba2);
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 500px;
            margin: 20px;
        }

        .victory-content h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #feca57;
        }

        .play-again-btn {
            background: linear-gradient(135deg, #feca57, #ff9ff3);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .play-again-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .difficulty-selector {
            text-align: center;
            margin-bottom: 20px;
        }

        .difficulty-btn {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid transparent;
            padding: 10px 20px;
            margin: 0 5px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .difficulty-btn.active {
            border-color: #feca57;
            background: linear-gradient(135deg, #feca57, #ff9ff3);
        }

        .difficulty-btn:hover {
            transform: translateY(-2px);
        }

        .score-display {
            text-align: center;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }

        .score-display h3 {
            margin-bottom: 10px;
        }

        .score-stats {
            display: flex;
            justify-content: space-around;
            flex-wrap: wrap;
            gap: 10px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #feca57;
        }

        /* Homepage Styles */
        .homepage {
            display: block;
            text-align: center;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .homepage::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                radial-gradient(circle at 20% 80%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 177, 153, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(120, 119, 198, 0.2) 0%, transparent 50%);
            z-index: -1;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(1deg); }
        }

        .game-screen {
            display: none;
        }

        .homepage h1 {
            font-family: 'Cinzel', serif;
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: #ffd700;
            text-shadow: 
                0 0 15px rgba(255, 215, 0, 0.9),
                0 0 30px rgba(255, 215, 0, 0.7),
                0 0 45px rgba(255, 215, 0, 0.5),
                3px 3px 6px rgba(0,0,0,0.6);
            letter-spacing: 3px;
            animation: magical-glow 3s ease-in-out infinite alternate;
        }

        @keyframes magical-glow {
            0% { 
                text-shadow: 
                    0 0 15px rgba(255, 215, 0, 0.9),
                    0 0 30px rgba(255, 215, 0, 0.7),
                    0 0 45px rgba(255, 215, 0, 0.5),
                    3px 3px 6px rgba(0,0,0,0.6);
            }
            100% { 
                text-shadow: 
                    0 0 20px rgba(255, 215, 0, 1),
                    0 0 40px rgba(255, 215, 0, 0.8),
                    0 0 60px rgba(255, 215, 0, 0.6),
                    3px 3px 6px rgba(0,0,0,0.6);
            }
        }



        .fantasy-subtitle {
            font-size: 1.2rem;
            color: #feca57;
            margin-bottom: 30px;
            font-style: italic;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
        }

        .game-description {
            background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05));
            padding: 40px;
            border-radius: 25px;
            margin-bottom: 30px;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(254, 202, 87, 0.3);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .game-description::before {
            content: '🏰';
            position: absolute;
            top: -10px;
            right: -10px;
            font-size: 4rem;
            opacity: 0.1;
            animation: spin 20s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .game-description h2 {
            color: #feca57;
            margin-bottom: 20px;
            font-size: 1.8rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .game-description p {
            margin-bottom: 20px;
            line-height: 1.8;
            font-size: 1.1rem;
        }

        .quest-intro {
            background: linear-gradient(45deg, rgba(255, 107, 107, 0.2), rgba(254, 202, 87, 0.2));
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid #ff6b6b;
            font-style: italic;
        }

        .features-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .feature-item {
            background: linear-gradient(135deg, rgba(255,255,255,0.1), rgba(255,255,255,0.05));
            padding: 25px;
            border-radius: 15px;
            border: 2px solid transparent;
            background-clip: padding-box;
            position: relative;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .feature-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 15px;
            padding: 2px;
            background: linear-gradient(45deg, #feca57, #ff9ff3, #667eea);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: exclude;
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
        }

        .feature-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(254, 202, 87, 0.3);
        }

        .feature-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: block;
        }

        .player-form {
            background: linear-gradient(135deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05));
            padding: 40px;
            border-radius: 25px;
            margin-bottom: 30px;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(102, 126, 234, 0.3);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .player-form::before {
            content: '⚔️';
            position: absolute;
            top: -10px;
            left: -10px;
            font-size: 4rem;
            opacity: 0.1;
            animation: bounce 2s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .player-form h3 {
            color: #feca57;
            margin-bottom: 25px;
            font-size: 1.8rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .form-group {
            margin-bottom: 25px;
            text-align: left;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #feca57;
            font-size: 1.1rem;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid rgba(254, 202, 87, 0.3);
            border-radius: 12px;
            font-size: 1.1rem;
            background: rgba(255,255,255,0.9);
            color: #333;
            transition: all 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #feca57;
            box-shadow: 0 0 20px rgba(254, 202, 87, 0.4);
            transform: translateY(-2px);
        }

        .start-game-btn {
            background: linear-gradient(135deg, #56ab2f, #a8e6cf);
            color: white;
            border: none;
            padding: 18px 50px;
            border-radius: 30px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 15px;
            position: relative;
            overflow: hidden;
        }

        .start-game-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s ease;
        }

        .start-game-btn:hover:not(:disabled)::before {
            left: 100%;
        }

        .start-game-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(86, 171, 47, 0.4);
        }

        .start-game-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .difficulty-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .difficulty-option {
            background: rgba(255,255,255,0.1);
            border: 3px solid transparent;
            border-radius: 15px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .difficulty-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(254, 202, 87, 0.3);
        }

        .difficulty-option.active {
            border-color: #feca57;
            background: linear-gradient(135deg, rgba(254, 202, 87, 0.3), rgba(255, 159, 243, 0.3));
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(254, 202, 87, 0.4);
        }

        .difficulty-icon {
            font-size: 2.5rem;
            margin-bottom: 8px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .difficulty-name {
            font-size: 1.1rem;
            font-weight: bold;
            color: #feca57;
            margin-bottom: 5px;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .difficulty-time {
            font-size: 0.9rem;
            color: #ff9ff3;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .difficulty-desc {
            font-size: 0.8rem;
            color: rgba(255,255,255,0.8);
            font-style: italic;
        }

        .hero-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .hero-option {
            background: rgba(255,255,255,0.1);
            border: 3px solid transparent;
            border-radius: 15px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .hero-option:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(254, 202, 87, 0.3);
        }

        .hero-option.active {
            border-color: #feca57;
            background: linear-gradient(135deg, rgba(254, 202, 87, 0.3), rgba(255, 159, 243, 0.3));
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(254, 202, 87, 0.4);
        }

        .hero-avatar-large {
            font-size: 3rem;
            margin-bottom: 8px;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 8px;
        }

        .hero-avatar-large img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
            border: 2px solid rgba(254, 202, 87, 0.3);
            transition: all 0.3s ease;
        }

        .hero-option.active .hero-avatar-large img {
            border-color: #feca57;
            box-shadow: 0 0 15px rgba(254, 202, 87, 0.5);
        }

        .hero-name {
            font-size: 0.9rem;
            font-weight: bold;
            color: #feca57;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .scoreboard-section {
            background: rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .scoreboard-section h3 {
            color: #feca57;
            margin-bottom: 20px;
        }

        .scoreboard-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .score-item {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid transparent;
        }

        .score-item.rank-1 { border-left-color: #ffd700; }
        .score-item.rank-2 { border-left-color: #c0c0c0; }
        .score-item.rank-3 { border-left-color: #cd7f32; }

        .score-item.current-player {
            background: rgba(254, 202, 87, 0.2);
            border-left-color: #feca57;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .rank-badge {
            background: linear-gradient(45deg, #feca57, #ff9ff3);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .player-name {
            font-weight: bold;
        }

        .player-class {
            color: #feca57;
            font-size: 0.9rem;
        }

        .score-value {
            font-weight: bold;
            color: #56ab2f;
        }

        .back-home-btn {
            background: rgba(255,255,255,0.1);
            color: white;
            border: 2px solid #feca57;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .back-home-btn:hover {
            background: linear-gradient(135deg, #feca57, #ff9ff3);
            transform: translateY(-2px);
        }

        .loading-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #feca57;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Boss Showdown Animation Styles */
        .boss-showdown {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 50% 50%, rgba(255, 0, 0, 0.3) 0%, transparent 70%),
                linear-gradient(45deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #533483 75%, #7209b7 100%);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* Boss Defeat Victory Animation */
        .boss-defeat-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 50% 50%, rgba(255, 215, 0, 0.4) 0%, transparent 70%),
                linear-gradient(45deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #533483 75%, #7209b7 100%);
            z-index: 3000;
            display: none;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .defeat-arena {
            width: 95%;
            max-width: 1200px;
            height: 85%;
            position: relative;
            background: 
                radial-gradient(circle at 50% 100%, rgba(255, 215, 0, 0.3) 0%, transparent 50%),
                linear-gradient(180deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.4) 50%, rgba(0,0,0,0.8) 100%);
            border-radius: 20px;
            border: 3px solid #ffd700;
            box-shadow: 
                0 0 50px rgba(255, 215, 0, 0.8),
                inset 0 0 50px rgba(255, 215, 0, 0.2);
            overflow: hidden;
        }

        .defeat-title {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'Cinzel', serif;
            font-size: 3rem;
            font-weight: bold;
            color: #ffd700;
            text-align: center;
            text-shadow: 
                0 0 30px rgba(255, 215, 0, 1),
                0 0 60px rgba(255, 215, 0, 0.8),
                3px 3px 6px rgba(0,0,0,0.8);
            animation: victory-glow 2s ease-in-out infinite alternate;
            z-index: 10;
        }

        @keyframes victory-glow {
            0% { 
                text-shadow: 
                    0 0 30px rgba(255, 215, 0, 1),
                    0 0 60px rgba(255, 215, 0, 0.8),
                    3px 3px 6px rgba(0,0,0,0.8);
            }
            100% { 
                text-shadow: 
                    0 0 40px rgba(255, 215, 0, 1),
                    0 0 80px rgba(255, 215, 0, 1),
                    0 0 100px rgba(255, 215, 0, 0.6),
                    3px 3px 6px rgba(0,0,0,0.8);
            }
        }

        .defeat-subtitle {
            position: absolute;
            top: 80px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5rem;
            color: #56ab2f;
            text-align: center;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            animation: subtitle-pulse 1.5s ease-in-out infinite;
            line-height: 1.2;
            max-width: 90%;
        }

        .defeat-combatants {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60%;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            padding: 0 80px;
        }

        .victorious-hero {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 5;
        }

        .victorious-hero-avatar {
            font-size: 10rem;
            margin-bottom: 20px;
            position: relative;
            z-index: 5;
            width: 250px;
            height: 250px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
            overflow: hidden;
            border: 4px solid #ffd700;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.8);
            animation: hero-victory-pose 3s ease-in-out infinite;
        }

        @keyframes hero-victory-pose {
            0%, 100% { 
                transform: scale(1) rotate(0deg);
                box-shadow: 0 0 40px rgba(255, 215, 0, 0.8);
            }
            25% { 
                transform: scale(1.05) rotate(2deg);
                box-shadow: 0 0 60px rgba(255, 215, 0, 1);
            }
            50% { 
                transform: scale(1.1) rotate(-1deg);
                box-shadow: 0 0 80px rgba(255, 215, 0, 1);
            }
            75% { 
                transform: scale(1.05) rotate(1deg);
                box-shadow: 0 0 60px rgba(255, 215, 0, 1);
            }
        }

        .defeated-boss {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 5;
        }

        .defeated-boss-avatar {
            font-size: 8rem;
            margin-bottom: 20px;
            position: relative;
            z-index: 5;
            width: 200px;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
            overflow: hidden;
            border: 4px solid #ff4757;
            box-shadow: 0 0 30px rgba(255, 71, 87, 0.6);
            animation: boss-defeated 4s ease-out forwards;
            opacity: 1;
        }

        @keyframes boss-defeated {
            0% { 
                transform: scale(1) rotate(0deg);
                opacity: 1;
                filter: brightness(1) hue-rotate(0deg);
            }
            30% { 
                transform: scale(0.9) rotate(-10deg);
                opacity: 0.8;
                filter: brightness(1.5) hue-rotate(180deg);
            }
            60% { 
                transform: scale(0.7) rotate(15deg);
                opacity: 0.6;
                filter: brightness(0.5) hue-rotate(360deg);
            }
            85% { 
                transform: scale(0.5) rotate(-20deg);
                opacity: 0.3;
                filter: brightness(2) hue-rotate(540deg);
            }
            100% { 
                transform: scale(0.2) rotate(360deg);
                opacity: 0.1;
                filter: brightness(0) hue-rotate(720deg);
            }
        }

        /* Hero-specific attack animations */
        @keyframes sword-slash {
            0% { 
                transform: translateX(-100px) rotate(-45deg) scaleX(0);
                opacity: 0;
            }
            50% { 
                transform: translateX(0) rotate(0deg) scaleX(1);
                opacity: 1;
            }
            100% { 
                transform: translateX(100px) rotate(45deg) scaleX(0);
                opacity: 0;
            }
        }

        @keyframes arrow-shot {
            0% { 
                transform: translateX(-150px) scale(0.5);
                opacity: 0;
            }
            30% { 
                transform: translateX(-50px) scale(1);
                opacity: 1;
            }
            100% { 
                transform: translateX(50px) scale(0.3);
                opacity: 0;
            }
        }

        @keyframes ice-spell {
            0% { 
                transform: scale(0) rotate(0deg);
                opacity: 0;
                filter: hue-rotate(0deg);
            }
            50% { 
                transform: scale(1.5) rotate(180deg);
                opacity: 1;
                filter: hue-rotate(180deg);
            }
            100% { 
                transform: scale(2) rotate(360deg);
                opacity: 0;
                filter: hue-rotate(360deg);
            }
        }

        @keyframes lightning-spell {
            0% { 
                transform: scaleY(0) scaleX(1);
                opacity: 0;
            }
            20% { 
                transform: scaleY(1) scaleX(0.8);
                opacity: 1;
            }
            40% { 
                transform: scaleY(0.8) scaleX(1.2);
                opacity: 0.8;
            }
            60% { 
                transform: scaleY(1.2) scaleX(0.6);
                opacity: 1;
            }
            100% { 
                transform: scaleY(0) scaleX(1);
                opacity: 0;
            }
        }

        @keyframes fairy-sparkles {
            0% { 
                transform: scale(0) rotate(0deg);
                opacity: 0;
            }
            25% { 
                transform: scale(0.5) rotate(90deg);
                opacity: 0.8;
            }
            50% { 
                transform: scale(1) rotate(180deg);
                opacity: 1;
            }
            75% { 
                transform: scale(1.2) rotate(270deg);
                opacity: 0.6;
            }
            100% { 
                transform: scale(0) rotate(360deg);
                opacity: 0;
            }
        }

        @keyframes boss-cut-in-half {
            0% { 
                transform: scale(1);
                opacity: 1;
                clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%);
                filter: brightness(1);
            }
            20% { 
                transform: scale(1.05);
                opacity: 1;
                clip-path: polygon(0% 0%, 100% 0%, 100% 100%, 0% 100%);
                filter: brightness(1.3);
            }
            50% { 
                transform: scale(1.1);
                opacity: 0.9;
                clip-path: polygon(0% 0%, 100% 0%, 100% 52%, 0% 48%);
                filter: brightness(1.5) contrast(1.2);
            }
            70% { 
                transform: scale(1.05);
                opacity: 0.7;
                clip-path: polygon(0% 0%, 100% 0%, 100% 45%, 0% 55%);
                filter: brightness(1.2) contrast(1.1);
            }
            100% { 
                transform: scale(0.8);
                opacity: 0;
                clip-path: polygon(0% 0%, 100% 0%, 100% 0%, 0% 100%);
                filter: brightness(0.5);
            }
        }

        @keyframes boss-arrow-tumble {
            0% { 
                transform: scale(1) rotate(0deg);
                opacity: 1;
                filter: brightness(1);
            }
            20% { 
                transform: scale(1.1) rotate(-5deg);
                opacity: 0.9;
                filter: brightness(1.3);
            }
            40% { 
                transform: scale(1.05) rotate(-15deg) translateX(-10px);
                opacity: 0.8;
                filter: brightness(1.1);
            }
            60% { 
                transform: scale(0.95) rotate(-30deg) translateX(-20px) translateY(10px);
                opacity: 0.6;
                filter: brightness(0.9);
            }
            80% { 
                transform: scale(0.8) rotate(-50deg) translateX(-40px) translateY(30px);
                opacity: 0.4;
                filter: brightness(0.7);
            }
            100% { 
                transform: scale(0.5) rotate(-90deg) translateX(-80px) translateY(60px);
                opacity: 0;
                filter: brightness(0.3);
            }
        }

        @keyframes boss-burn-effect {
            0% { 
                transform: scale(1);
                opacity: 1;
                filter: brightness(1) hue-rotate(0deg) saturate(1);
                box-shadow: 0 0 20px rgba(255, 71, 87, 0.3);
            }
            25% { 
                transform: scale(1.1);
                opacity: 0.9;
                filter: brightness(1.5) hue-rotate(30deg) saturate(1.5);
                box-shadow: 0 0 40px rgba(255, 140, 0, 0.8);
            }
            50% { 
                transform: scale(1.05);
                opacity: 0.8;
                filter: brightness(2) hue-rotate(60deg) saturate(2);
                box-shadow: 0 0 60px rgba(255, 69, 0, 1);
            }
            75% { 
                transform: scale(0.9);
                opacity: 0.6;
                filter: brightness(1.8) hue-rotate(90deg) saturate(1.8);
                box-shadow: 0 0 50px rgba(255, 0, 0, 0.9);
            }
            100% { 
                transform: scale(0.3);
                opacity: 0;
                filter: brightness(3) hue-rotate(120deg) saturate(3);
                box-shadow: 0 0 80px rgba(139, 69, 19, 0.5);
            }
        }

        @keyframes boss-freeze-shatter {
            0% { 
                transform: scale(1);
                opacity: 1;
                filter: brightness(1) hue-rotate(0deg);
            }
            25% { 
                transform: scale(1.05);
                opacity: 0.9;
                filter: brightness(1.5) hue-rotate(180deg) saturate(0.3);
                border-color: #87CEEB !important;
                box-shadow: 0 0 30px #87CEEB !important;
            }
            50% { 
                transform: scale(0.95);
                opacity: 0.7;
                filter: brightness(0.8) hue-rotate(270deg) saturate(0.1);
                border-color: #4682B4 !important;
                box-shadow: 0 0 40px #4682B4 !important;
            }
            100% { 
                transform: scale(0.3);
                opacity: 0;
                filter: brightness(2) hue-rotate(360deg) saturate(0);
            }
        }

        @keyframes boss-lightning-strike {
            0% { 
                transform: scale(1);
                opacity: 1;
                filter: brightness(1) contrast(1);
            }
            25% { 
                transform: scale(1.1);
                opacity: 0.9;
                filter: brightness(3) contrast(2);
            }
            50% { 
                transform: scale(0.9);
                opacity: 0.8;
                filter: brightness(0.5) contrast(1.5);
            }
            75% { 
                transform: scale(1.05);
                opacity: 0.6;
                filter: brightness(2.5) contrast(2);
            }
            100% { 
                transform: scale(0.2);
                opacity: 0;
                filter: brightness(0) contrast(1);
            }
        }

        @keyframes boss-sparkle-fade {
            0% { 
                transform: scale(1);
                opacity: 1;
                filter: brightness(1) saturate(1);
            }
            30% { 
                transform: scale(1.1);
                opacity: 0.8;
                filter: brightness(1.8) saturate(2);
            }
            60% { 
                transform: scale(0.9);
                opacity: 0.6;
                filter: brightness(1.5) saturate(1.5);
            }
            85% { 
                transform: scale(1.05);
                opacity: 0.3;
                filter: brightness(2) saturate(2.5);
            }
            100% { 
                transform: scale(0);
                opacity: 0;
                filter: brightness(3) saturate(3);
            }
        }

        /* Hero Skill Animations */
        @keyframes epic-sword-slash {
            0% { 
                transform: translateX(-400px) rotate(-45deg) scaleX(0);
                opacity: 0;
            }
            30% { 
                transform: translateX(-100px) rotate(-15deg) scaleX(1);
                opacity: 1;
            }
            70% { 
                transform: translateX(200px) rotate(15deg) scaleX(1);
                opacity: 1;
            }
            100% { 
                transform: translateX(500px) rotate(45deg) scaleX(0);
                opacity: 0;
            }
        }

        @keyframes sword-trail {
            0% { opacity: 0; transform: scaleX(0); }
            50% { opacity: 1; transform: scaleX(1); }
            100% { opacity: 0; transform: scaleX(0); }
        }

        @keyframes epic-arrow-shot {
            0% { 
                transform: translateX(-300px) scale(0.5);
                opacity: 0;
            }
            20% { 
                transform: translateX(-100px) scale(1);
                opacity: 1;
            }
            80% { 
                transform: translateX(200px) scale(1);
                opacity: 1;
            }
            100% { 
                transform: translateX(400px) scale(0.3);
                opacity: 0;
            }
        }

        @keyframes feather-glow {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 0 5px #228B22;
            }
            50% { 
                transform: scale(1.5);
                box-shadow: 0 0 15px #32CD32;
            }
        }

        @keyframes epic-ice-spell {
            0% { 
                transform: scale(0) rotate(0deg);
                opacity: 0;
                filter: hue-rotate(0deg) brightness(1);
            }
            30% { 
                transform: scale(1.2) rotate(180deg);
                opacity: 1;
                filter: hue-rotate(90deg) brightness(1.5);
            }
            70% { 
                transform: scale(1.5) rotate(360deg);
                opacity: 1;
                filter: hue-rotate(180deg) brightness(2);
            }
            100% { 
                transform: scale(2) rotate(540deg);
                opacity: 0;
                filter: hue-rotate(270deg) brightness(3);
            }
        }

        @keyframes crystal-spin {
            0% { 
                transform: rotate(0deg) translateY(-40px) scale(0);
                opacity: 0;
            }
            50% { 
                transform: rotate(180deg) translateY(-50px) scale(1.2);
                opacity: 1;
            }
            100% { 
                transform: rotate(360deg) translateY(-60px) scale(0);
                opacity: 0;
            }
        }

        @keyframes epic-lightning {
            0% { 
                transform: scaleY(0) scaleX(1);
                opacity: 0;
                filter: brightness(1);
            }
            20% { 
                transform: scaleY(1) scaleX(0.8);
                opacity: 1;
                filter: brightness(3);
            }
            40% { 
                transform: scaleY(0.8) scaleX(1.2);
                opacity: 0.8;
                filter: brightness(2);
            }
            60% { 
                transform: scaleY(1.2) scaleX(0.6);
                opacity: 1;
                filter: brightness(4);
            }
            100% { 
                transform: scaleY(0) scaleX(1);
                opacity: 0;
                filter: brightness(1);
            }
        }

        @keyframes lightning-branch {
            0% { 
                transform: scale(0) rotate(0deg);
                opacity: 0;
            }
            50% { 
                transform: scale(1.5) rotate(15deg);
                opacity: 1;
            }
            100% { 
                transform: scale(0) rotate(30deg);
                opacity: 0;
            }
        }

        @keyframes epic-fairy-magic {
            0% { 
                transform: scale(0) rotate(0deg);
                opacity: 0;
                filter: hue-rotate(0deg) brightness(1);
            }
            25% { 
                transform: scale(0.8) rotate(90deg);
                opacity: 0.8;
                filter: hue-rotate(90deg) brightness(1.5);
            }
            50% { 
                transform: scale(1.2) rotate(180deg);
                opacity: 1;
                filter: hue-rotate(180deg) brightness(2);
            }
            75% { 
                transform: scale(1.5) rotate(270deg);
                opacity: 0.8;
                filter: hue-rotate(270deg) brightness(2.5);
            }
            100% { 
                transform: scale(2) rotate(360deg);
                opacity: 0;
                filter: hue-rotate(360deg) brightness(3);
            }
        }

        @keyframes sparkle-burst {
            0% { 
                transform: rotate(0deg) translateY(-60px) scale(0);
                opacity: 0;
            }
            30% { 
                transform: rotate(90deg) translateY(-80px) scale(1.2);
                opacity: 1;
            }
            70% { 
                transform: rotate(180deg) translateY(-100px) scale(1);
                opacity: 1;
            }
            100% { 
                transform: rotate(270deg) translateY(-120px) scale(0);
                opacity: 0;
            }
        }

        @keyframes epic-energy-blast {
            0% { 
                transform: scale(0);
                opacity: 0;
                filter: brightness(1);
            }
            50% { 
                transform: scale(1.5);
                opacity: 1;
                filter: brightness(2);
            }
            100% { 
                transform: scale(2);
                opacity: 0;
                filter: brightness(3);
            }
        }

        .victory-effects {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100%;
            pointer-events: none;
        }

        .victory-wave {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 30px;
            background: linear-gradient(90deg, 
                rgba(255, 215, 0, 0.6) 0%, 
                rgba(86, 171, 47, 0.8) 50%, 
                rgba(255, 215, 0, 0.6) 100%);
            animation: victory-pulse 2s ease-in-out infinite;
        }

        .victory-wave:nth-child(2) {
            height: 25px;
            animation-delay: 0.3s;
            opacity: 0.8;
        }

        .victory-wave:nth-child(3) {
            height: 20px;
            animation-delay: 0.6s;
            opacity: 0.6;
        }

        @keyframes victory-pulse {
            0%, 100% { 
                transform: scaleY(1);
                opacity: 0.4;
            }
            50% { 
                transform: scaleY(3);
                opacity: 1;
            }
        }

        .continue-victory-btn {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #56ab2f, #a8e6cf);
            color: white;
            border: none;
            padding: 18px 50px;
            border-radius: 30px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0;
            animation: continue-btn-appear 0.5s ease-out 3s forwards;
            box-shadow: 0 8px 20px rgba(86, 171, 47, 0.4);
        }

        .continue-victory-btn:hover {
            transform: translateX(-50%) translateY(-3px);
            box-shadow: 0 8px 25px rgba(86, 171, 47, 0.6);
        }

        .boss-showdown::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.2);
            opacity: 0.8;
        }

        .showdown-arena {
            width: 95%;
            max-width: 1200px;
            height: 85%;
            position: relative;
            background: 
                radial-gradient(circle at 50% 100%, rgba(255, 215, 0, 0.2) 0%, transparent 50%),
                linear-gradient(180deg, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0.4) 50%, rgba(0,0,0,0.8) 100%);
            border-radius: 20px;
            border: 3px solid #ffd700;
            box-shadow: 
                0 0 50px rgba(255, 215, 0, 0.5),
                inset 0 0 50px rgba(255, 215, 0, 0.1);
            overflow: hidden;
        }

        .showdown-title {
            display: none;
        }

        @keyframes title-glow {
            0% { 
                text-shadow: 
                    0 0 20px rgba(255, 215, 0, 1),
                    0 0 40px rgba(255, 215, 0, 0.8),
                    3px 3px 6px rgba(0,0,0,0.8);
            }
            100% { 
                text-shadow: 
                    0 0 30px rgba(255, 215, 0, 1),
                    0 0 60px rgba(255, 215, 0, 1),
                    0 0 80px rgba(255, 215, 0, 0.6),
                    3px 3px 6px rgba(0,0,0,0.8);
            }
        }

        .showdown-subtitle {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.5rem;
            color: #ff6b6b;
            text-align: center;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            animation: subtitle-pulse 1.5s ease-in-out infinite;
            line-height: 1.2;
            max-width: 90%;
        }

        @keyframes subtitle-pulse {
            0%, 100% { opacity: 0.8; transform: translateX(-50%) scale(1); }
            50% { opacity: 1; transform: translateX(-50%) scale(1.05); }
        }

        .combatants {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60%;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            padding: 0 80px;
        }

        .hero-side, .boss-side {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
        }

        .hero-avatar, .boss-avatar {
            font-size: 8rem;
            margin-bottom: 20px;
            position: relative;
            z-index: 5;
            width: 200px;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 20px;
            overflow: hidden;
            border: 4px solid;
        }

        .hero-avatar {
            animation: hero-entrance 2s ease-out;
            text-shadow: 
                0 0 20px rgba(102, 126, 234, 0.8),
                0 0 40px rgba(102, 126, 234, 0.6);
            border-color: #667eea;
            box-shadow: 0 0 30px rgba(102, 126, 234, 0.6);
        }

        .boss-avatar {
            animation: boss-entrance 2s ease-out 0.5s both;
            text-shadow: 
                0 0 20px rgba(255, 71, 87, 0.8),
                0 0 40px rgba(255, 71, 87, 0.6);
            border-color: #ff4757;
            box-shadow: 0 0 30px rgba(255, 71, 87, 0.6);
        }

        @keyframes hero-entrance {
            0% { 
                transform: translateX(-200px) scale(0.5);
                opacity: 0;
            }
            50% {
                transform: translateX(-50px) scale(1.1);
                opacity: 0.8;
            }
            100% { 
                transform: translateX(0) scale(1);
                opacity: 1;
            }
        }

        @keyframes boss-entrance {
            0% { 
                transform: translateX(200px) scale(0.5);
                opacity: 0;
            }
            50% {
                transform: translateX(50px) scale(1.1);
                opacity: 0.8;
            }
            100% { 
                transform: translateX(0) scale(1);
                opacity: 1;
            }
        }

        .character-name {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        .hero-name {
            color: #667eea;
            animation: hero-name-glow 2s ease-in-out infinite alternate;
        }

        .boss-name {
            color: #ff4757;
            animation: boss-name-glow 2s ease-in-out infinite alternate;
        }

        @keyframes hero-name-glow {
            0% { text-shadow: 2px 2px 4px rgba(0,0,0,0.8), 0 0 10px rgba(102, 126, 234, 0.5); }
            100% { text-shadow: 2px 2px 4px rgba(0,0,0,0.8), 0 0 20px rgba(102, 126, 234, 0.8); }
        }

        @keyframes boss-name-glow {
            0% { text-shadow: 2px 2px 4px rgba(0,0,0,0.8), 0 0 10px rgba(255, 71, 87, 0.5); }
            100% { text-shadow: 2px 2px 4px rgba(0,0,0,0.8), 0 0 20px rgba(255, 71, 87, 0.8); }
        }

        .character-stats {
            background: rgba(0,0,0,0.7);
            padding: 15px 25px;
            border-radius: 15px;
            border: 2px solid;
            backdrop-filter: blur(10px);
            text-align: center;
            min-width: 200px;
            margin-bottom: 20px;
        }

        .hero-stats {
            border-color: #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
        }

        .boss-stats {
            border-color: #ff4757;
            box-shadow: 0 0 20px rgba(255, 71, 87, 0.3);
        }

        .stat-line {
            margin: 5px 0;
            font-size: 1.1rem;
        }

        .vs-symbol {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 6rem;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 
                0 0 30px rgba(255, 215, 0, 1),
                0 0 60px rgba(255, 215, 0, 0.8),
                3px 3px 6px rgba(0,0,0,0.8);
            animation: vs-pulse 1s ease-in-out infinite alternate;
            z-index: 10;
        }

        @keyframes vs-pulse {
            0% { 
                transform: translate(-50%, -50%) scale(1);
                text-shadow: 
                    0 0 30px rgba(255, 215, 0, 1),
                    0 0 60px rgba(255, 215, 0, 0.8),
                    3px 3px 6px rgba(0,0,0,0.8);
            }
            100% { 
                transform: translate(-50%, -50%) scale(1.1);
                text-shadow: 
                    0 0 40px rgba(255, 215, 0, 1),
                    0 0 80px rgba(255, 215, 0, 1),
                    0 0 100px rgba(255, 215, 0, 0.6),
                    3px 3px 6px rgba(0,0,0,0.8);
            }
        }

        .energy-waves {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 100%;
            pointer-events: none;
        }

        .energy-wave {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 20px;
            background: linear-gradient(90deg, 
                rgba(102, 126, 234, 0.3) 0%, 
                rgba(255, 215, 0, 0.5) 50%, 
                rgba(255, 71, 87, 0.3) 100%);
            animation: energy-pulse 2s ease-in-out infinite;
        }

        .energy-wave:nth-child(2) {
            height: 15px;
            animation-delay: 0.5s;
            opacity: 0.7;
        }

        .energy-wave:nth-child(3) {
            height: 10px;
            animation-delay: 1s;
            opacity: 0.5;
        }

        @keyframes energy-pulse {
            0%, 100% { 
                transform: scaleY(1);
                opacity: 0.3;
            }
            50% { 
                transform: scaleY(2);
                opacity: 0.8;
            }
        }

        .continue-btn {
            position: absolute;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #56ab2f, #a8e6cf);
            color: white;
            border: none;
            padding: 18px 50px;
            border-radius: 30px;
            font-size: 1.3rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0;
            animation: continue-btn-appear 0.5s ease-out 2s forwards;
            box-shadow: 0 8px 20px rgba(86, 171, 47, 0.4);
        }

        @keyframes continue-btn-appear {
            0% { 
                opacity: 0;
                transform: translateX(-50%) translateY(20px);
            }
            100% { 
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .continue-btn:hover {
            transform: translateX(-50%) translateY(-3px);
            box-shadow: 0 8px 25px rgba(86, 171, 47, 0.6);
        }

        /* Countdown Timer Styles */
        .countdown-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 50% 50%, rgba(255, 215, 0, 0.2) 0%, transparent 70%),
                linear-gradient(45deg, rgba(0,0,0,0.9) 0%, rgba(0,0,0,0.7) 100%);
            z-index: 10000;
            display: none;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .countdown-display {
            text-align: center;
            color: #ffd700;
            font-family: 'Cinzel', serif;
        }

        .countdown-number {
            font-size: 15rem;
            font-weight: bold;
            text-shadow: 
                0 0 30px rgba(255, 215, 0, 1),
                0 0 60px rgba(255, 215, 0, 0.8),
                0 0 90px rgba(255, 215, 0, 0.6),
                5px 5px 10px rgba(0,0,0,0.8);
            animation: countdown-pulse 1s ease-in-out;
            margin-bottom: 20px;
        }

        .countdown-go {
            font-size: 12rem;
            font-weight: bold;
            text-shadow: 
                0 0 40px rgba(255, 215, 0, 1),
                0 0 80px rgba(255, 215, 0, 1),
                0 0 120px rgba(255, 215, 0, 0.8),
                5px 5px 10px rgba(0,0,0,0.8);
            animation: countdown-go 1s ease-in-out;
            margin-bottom: 20px;
        }

        @keyframes countdown-pulse {
            0% { 
                transform: scale(0.5);
                opacity: 0;
            }
            50% { 
                transform: scale(1.2);
                opacity: 1;
            }
            100% { 
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes countdown-go {
            0% { 
                transform: scale(0.3);
                opacity: 0;
            }
            30% { 
                transform: scale(1.3);
                opacity: 1;
            }
            60% { 
                transform: scale(0.9);
                opacity: 1;
            }
            100% { 
                transform: scale(1);
                opacity: 1;
            }
        }

        .countdown-subtitle {
            font-size: 2rem;
            color: #ff9ff3;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            animation: subtitle-glow 1s ease-in-out infinite alternate;
        }

        @keyframes subtitle-glow {
            0% { 
                text-shadow: 2px 2px 4px rgba(0,0,0,0.8), 0 0 20px rgba(255, 159, 243, 0.5);
            }
            100% { 
                text-shadow: 2px 2px 4px rgba(0,0,0,0.8), 0 0 40px rgba(255, 159, 243, 0.8);
            }
        }

        /* Notification Popup Styles */
        .notification-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, rgba(0,0,0,0.95), rgba(0,0,0,0.85));
            color: white;
            padding: 40px 60px;
            border-radius: 25px;
            font-size: 1.8rem;
            font-weight: bold;
            z-index: 9999;
            text-align: center;
            backdrop-filter: blur(15px);
            border: 3px solid;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            opacity: 0;
            transform: translate(-50%, -50%) scale(0.5);
            transition: all 0.5s ease;
            max-width: 90%;
        }

        .notification-popup.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .notification-popup.success {
            border-color: #56ab2f;
            box-shadow: 0 20px 40px rgba(86, 171, 47, 0.3);
        }

        .notification-popup.error {
            border-color: #ff4757;
            box-shadow: 0 20px 40px rgba(255, 71, 87, 0.3);
        }

        .notification-popup.warning {
            border-color: #feca57;
            box-shadow: 0 20px 40px rgba(254, 202, 87, 0.3);
        }

        .notification-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            display: block;
        }

        .notification-title {
            font-size: 2.2rem;
            margin-bottom: 15px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        .notification-message {
            font-size: 1.4rem;
            line-height: 1.4;
            opacity: 0.9;
        }


        
        /* Landscape Mode Prompt */
        .landscape-prompt {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #533483 75%, #7209b7 100%);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            text-align: center;
            color: white;
            padding: 20px;
        }

        .landscape-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: rotate-phone 2s ease-in-out infinite;
        }

        @keyframes rotate-phone {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(90deg); }
        }

        .landscape-title {
            font-family: 'Cinzel', serif;
            font-size: 2rem;
            color: #ffd700;
            margin-bottom: 15px;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        .landscape-message {
            font-size: 1.2rem;
            margin-bottom: 20px;
            line-height: 1.5;
            max-width: 400px;
        }

        .continue-anyway-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .continue-anyway-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        /* Mobile Portrait Mode - Show landscape prompt */
        @media screen and (max-width: 768px) and (orientation: portrait) {
            .landscape-prompt {
                display: flex;
            }
            
            .homepage, .game-screen {
                display: none !important;
            }
            
            /* Allow victory screens to show in portrait with better layout */
            .victory-screen, .boss-defeat-screen {
                display: flex !important;
                padding: 5px;
                align-items: flex-start;
                overflow-y: auto;
            }
            
            .victory-content, .defeat-arena {
                max-width: 95%;
                max-height: 95vh;
                overflow-y: auto;
                margin: 5px;
            }
            
            .victory-content {
                padding: 10px;
            }
            
            .victory-content h2 {
                font-size: 1.3rem;
                margin-bottom: 8px;
            }
            
            .victory-content p {
                font-size: 0.8rem;
                margin-bottom: 6px;
                line-height: 1.2;
            }
            
            .play-again-btn {
                padding: 8px 16px;
                font-size: 0.8rem;
                margin: 2px;
                display: block;
                width: 100%;
                margin-bottom: 6px;
            }
            
            .continue-btn, .continue-victory-btn {
                padding: 8px 20px;
                font-size: 0.8rem;
                bottom: 5px;
                position: fixed;
                left: 50%;
                transform: translateX(-50%);
                z-index: 10001;
            }
        }

        /* Mobile Phone Optimization - All orientations */
        @media screen and (max-width: 768px) {
            body {
                font-size: 14px;
                overflow-x: hidden;
            }
            
            .game-container {
                padding: 4px;
                max-width: 100vw;
                overflow-x: hidden;
            }
            
            .header {
                margin-bottom: 8px;
            }
            
            .header h1 {
                font-size: 1.2rem;
                margin-bottom: 2px;
                line-height: 1.2;
            }
            
            .header p {
                font-size: 0.7rem;
                margin-bottom: 4px;
            }
            
            .game-stats {
                grid-template-columns: 1fr auto 1fr;
                gap: 4px;
                padding: 4px;
                margin-bottom: 6px;
            }
            
            .timer-circle {
                width: 35px;
                height: 35px;
            }
            
            .timer-text {
                font-size: 0.8rem;
            }
            
            .character-avatar {
                width: 30px;
                height: 30px;
                font-size: 12px;
            }
            
            .monster-avatar {
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            
            .level-info h3 {
                font-size: 0.7rem;
                margin-bottom: 2px;
            }
            
            .level-info small {
                font-size: 0.6rem;
            }
            
            .xp-bar {
                width: 80px;
                height: 4px;
            }
            
            .hp-bar {
                width: 70px;
                height: 4px;
            }
            
            .monster-info h4 {
                font-size: 0.7rem;
                margin-bottom: 2px;
            }
            
            .monster-info small {
                font-size: 0.6rem;
            }
            
            .power-ups {
                margin-bottom: 4px;
                gap: 2px;
                flex-wrap: wrap;
            }
            
            .power-up-btn {
                padding: 3px 6px;
                font-size: 0.6rem;
                border-radius: 12px;
                flex: 1;
                min-width: 80px;
            }
            
            .game-board {
                grid-template-columns: 1fr;
                gap: 6px;
                margin-bottom: 6px;
            }
            
            .card-section {
                padding: 6px;
                border-radius: 8px;
            }
            
            .card-section h3 {
                font-size: 0.8rem;
                margin-bottom: 4px;
            }
            
            .cards-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 4px;
            }
            
            .card {
                padding: 6px;
                min-height: 35px;
                font-size: 0.65rem;
                border-radius: 6px;
                line-height: 1.2;
            }
            
            .feedback {
                font-size: 0.7rem;
                margin: 4px 0;
                min-height: 15px;
                padding: 0 4px;
            }
            
            .score-display {
                padding: 4px;
                margin-bottom: 4px;
                border-radius: 6px;
            }
            
            .score-display h3 {
                font-size: 0.8rem;
                margin-bottom: 3px;
            }
            
            .score-stats {
                gap: 6px;
                flex-wrap: wrap;
            }
            
            .stat-value {
                font-size: 0.9rem;
            }
            
            .stat-item div:last-child {
                font-size: 0.6rem;
            }
            
            .player-header {
                padding: 4px;
                margin-bottom: 4px;
                border-radius: 6px;
            }
            
            .player-header h3 {
                font-size: 0.8rem;
                margin-bottom: 2px;
            }
            
            .player-header p {
                font-size: 0.7rem;
            }
            
            .back-home-btn {
                padding: 4px 8px;
                font-size: 0.7rem;
                margin-bottom: 4px;
                border-radius: 12px;
            }
        }

        /* Mobile Landscape Mode - Horizontal layout optimization */
        @media screen and (max-width: 768px) and (orientation: landscape) {
            .game-board {
                grid-template-columns: 1fr 1fr;
                gap: 4px;
            }
            
            .cards-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 3px;
            }
            
            .card {
                padding: 4px;
                min-height: 30px;
                font-size: 0.6rem;
            }
            
            .power-ups {
                justify-content: center;
            }
            
            .power-up-btn {
                min-width: 70px;
                padding: 2px 4px;
            }
        }

        /* Tablet and larger screens - keep desktop layout */
        @media screen and (min-width: 769px) {
            .landscape-prompt {
                display: none !important;
            }
        }
            

        
        /* Boss Showdown Mobile Styles */
        @media (max-width: 768px) {
            .showdown-title {
                font-size: 1rem;
                top: 2px;
                line-height: 1.2;
            }
            
            .showdown-subtitle {
                font-size: 0.7rem;
                top: 25px;
                line-height: 1.2;
            }
            
            .hero-avatar, .boss-avatar {
                font-size: 1.5rem;
                width: 50px;
                height: 50px;
            }
            
            .vs-symbol {
                font-size: 1.5rem;
            }
            
            .combatants {
                padding: 0 4px;
                height: 40%;
            }
            
            .character-stats {
                min-width: 70px;
                padding: 3px 6px;
                border-radius: 8px;
            }
            
            .stat-line {
                font-size: 0.55rem;
                margin: 1px 0;
            }
            
            .character-name {
                font-size: 0.7rem;
                margin-bottom: 3px;
            }
            
            .continue-btn, .continue-victory-btn {
                padding: 6px 15px;
                font-size: 0.7rem;
                bottom: 5px;
                position: fixed;
                left: 50%;
                transform: translateX(-50%);
                z-index: 10001;
                border-radius: 15px;
            }

            .notification-popup {
                padding: 8px 12px;
                font-size: 0.8rem;
                max-width: 95%;
                border-radius: 12px;
            }

            .notification-title {
                font-size: 0.9rem;
                margin-bottom: 4px;
            }

            .notification-message {
                font-size: 0.7rem;
                line-height: 1.3;
            }

            .notification-icon {
                font-size: 1.5rem;
                margin-bottom: 4px;
            }
            
            .defeat-title {
                font-size: 1rem;
                margin-bottom: 4px;
                top: 2px;
                line-height: 1.2;
            }
            
            .defeat-subtitle {
                font-size: 0.6rem;
                top: 30px;
                line-height: 1.2;
            }
            
            .victorious-hero-avatar, .defeated-boss-avatar {
                width: 80px;
                height: 80px;
                font-size: 2rem;
            }
            
            .defeat-combatants {
                padding: 0 8px;
                height: 45%;
            }
            
            .defeat-arena {
                height: 95%;
                width: 99%;
                border-radius: 12px;
            }
            
            .boss-defeat-screen {
                padding: 2px;
            }
            
            .showdown-arena {
                height: 95%;
                width: 99%;
                border-radius: 12px;
            }
            
            .boss-showdown {
                padding: 2px;
            }
        }
        
        /* Homepage Mobile Styles - Mobile-optimized */
        @media (max-width: 768px) {
            .homepage {
                padding: 8px;
                overflow-x: hidden;
            }
            
            .homepage h1 {
                font-size: 1.5rem;
                margin-bottom: 6px;
                line-height: 1.2;
            }
            
            .fantasy-subtitle {
                font-size: 0.9rem;
                margin-bottom: 12px;
            }
            
            .game-description {
                padding: 12px;
                margin-bottom: 12px;
                border-radius: 12px;
            }
            
            .game-description h2 {
                font-size: 1.1rem;
                margin-bottom: 8px;
            }
            
            .game-description p {
                font-size: 0.8rem;
                line-height: 1.4;
                margin-bottom: 8px;
            }
            
            .quest-intro {
                padding: 8px;
                margin: 8px 0;
                border-radius: 8px;
                font-size: 0.75rem;
            }
            
            .features-list {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
                margin: 12px 0;
            }
            
            .feature-item {
                padding: 8px;
                border-radius: 8px;
            }
            
            .feature-icon {
                font-size: 1.5rem;
                margin-bottom: 4px;
            }
            
            .feature-item strong {
                font-size: 0.75rem;
                display: block;
                margin-bottom: 2px;
            }
            
            .feature-item br + text {
                font-size: 0.65rem;
            }
            
            .player-form {
                padding: 12px;
                margin-bottom: 12px;
                border-radius: 12px;
            }
            
            .player-form h3 {
                font-size: 1.1rem;
                margin-bottom: 8px;
            }
            
            .form-group {
                margin-bottom: 12px;
            }
            
            .form-group label {
                font-size: 0.8rem;
                margin-bottom: 4px;
            }
            
            .form-group input {
                padding: 8px;
                font-size: 0.9rem;
                border-radius: 8px;
            }
            
            .difficulty-selection {
                grid-template-columns: repeat(2, 1fr);
                gap: 6px;
                margin-top: 8px;
            }
            
            .difficulty-option {
                padding: 8px 6px;
                border-radius: 8px;
            }
            
            .difficulty-icon {
                font-size: 1.5rem;
                margin-bottom: 4px;
            }
            
            .difficulty-name {
                font-size: 0.75rem;
                margin-bottom: 2px;
            }
            
            .difficulty-time {
                font-size: 0.65rem;
                margin-bottom: 2px;
            }
            
            .difficulty-desc {
                font-size: 0.6rem;
            }
            
            .hero-selection {
                grid-template-columns: repeat(3, 1fr);
                gap: 6px;
                margin-top: 8px;
            }
            
            .hero-option {
                padding: 6px 4px;
                border-radius: 8px;
            }
            
            .hero-avatar-large {
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
                margin-bottom: 4px;
            }
            
            .hero-avatar-large img {
                border-radius: 6px;
            }
            
            .hero-name {
                font-size: 0.7rem;
            }
            
            .start-game-btn {
                padding: 10px 20px;
                font-size: 0.9rem;
                border-radius: 20px;
                margin-top: 8px;
                width: 100%;
            }
        }
        
        /* Countdown Mobile Styles */
        @media (max-width: 768px) {
            .countdown-number {
                font-size: 4rem;
                margin-bottom: 8px;
            }
            
            .countdown-go {
                font-size: 3rem;
                margin-bottom: 8px;
            }
            
            .countdown-subtitle {
                font-size: 1rem;
                line-height: 1.2;
            }
            
            .countdown-overlay {
                padding: 8px;
            }
        }
        
        /* Victory Screen Mobile Styles */
        @media (max-width: 768px) {
            .victory-screen {
                padding: 4px;
                align-items: center;
                overflow-y: auto;
            }
            
            .victory-content {
                padding: 8px;
                margin: 2px;
                max-width: 98%;
                max-height: 95vh;
                overflow-y: auto;
                border-radius: 12px;
            }
            
            .victory-content h2 {
                font-size: 1.2rem;
                margin-bottom: 6px;
                line-height: 1.2;
            }
            
            .victory-content p {
                font-size: 0.75rem;
                margin-bottom: 4px;
                line-height: 1.3;
            }
            
            .play-again-btn {
                padding: 6px 12px;
                font-size: 0.7rem;
                margin: 2px 0;
                display: block;
                width: 100%;
                border-radius: 15px;
            }
            
            .play-again-btn:last-child {
                margin-left: 0 !important;
            }
        }
        




        .player-header {
            text-align: center;
            margin-bottom: 20px;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .player-header h3 {
            color: #feca57;
            margin-bottom: 5px;
        }
        
        /* Touch-friendly improvements */
        .card {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        
        .power-up-btn, .play-again-btn, .start-game-btn, .back-home-btn, .continue-btn, .continue-victory-btn {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Prevent zoom on input focus */
        input {
            font-size: 16px;
        }
    </style>
</head>
<body>


    <!-- Landscape Mode Prompt -->
    <div class="landscape-prompt" id="landscape-prompt">
        <div class="landscape-icon">📱</div>
        <div class="landscape-title">🏰 Rotate Your Device 🏰</div>
        <div class="landscape-message">
            For the best Vocabulary Quest experience, please rotate your device to landscape mode!
        </div>
        <button class="continue-anyway-btn" onclick="hideLandscapePrompt()">
            Continue in Portrait
        </button>
    </div>

    <!-- Homepage -->
    <div class="homepage" id="homepage">
        <h1>🗡️ Vocabulary Quest: Realm of Words 🐉</h1>
        <div class="fantasy-subtitle">⚡ "Where Knowledge Becomes Power" ⚡</div>
        
        <div class="game-description">
            <h2>🏰 Welcome, Young Scholar, to the Mystical Realm!</h2>
            <p>In the ancient Kingdom of Lexiconia, dark creatures have stolen the sacred words from the Great Library! As a brave Word Warrior, you must venture through 6 treacherous dungeons to reclaim the lost vocabulary and restore knowledge to the realm.</p>
            
            <div class="quest-intro">
                <strong>🧙‍♂️ The Oracle's Prophecy:</strong> "Only those who can match the ancient words to their true meanings shall have the power to defeat the Vocabulary Demons and become legendary Word Masters!"
            </div>
            
            <div class="features-list">
                <div class="feature-item">
                    <span class="feature-icon">🏰</span>
                    <strong>6 Mystical Dungeons</strong><br>
                    Journey from Apprentice to Master levels
                </div>
                <div class="feature-item">
                    <span class="feature-icon">⚔️</span>
                    <strong>4 Combat Modes</strong><br>
                    Novice, Warrior, Champion, and Legendary
                </div>
                <div class="feature-item">
                    <span class="feature-icon">🔮</span>
                    <strong>Magical Artifacts</strong><br>
                    Oracle's Hint, Time Crystal, and Power Gem
                </div>
                <div class="feature-item">
                    <span class="feature-icon">👑</span>
                    <strong>Hall of Fame</strong><br>
                    Claim your place among the Word Legends
                </div>
            </div>
            
            <p><strong>⚔️ Battle System:</strong> Choose a word, then find its matching meaning to cast powerful spells! Correct matches deal damage to monsters, while mistakes heal them and drain your magical energy. Conquer all 6 dungeons to become the ultimate Word Master!</p>
        </div>

        <div class="player-form">
            <h3>⚔️ Hero Registration Scroll</h3>
            <div class="form-group">
                <label for="player-name">🧙‍♂️ Your Hero Name:</label>
                <input type="text" id="player-name" placeholder="Enter your legendary name..." maxlength="30">
            </div>
            <div class="form-group">
                <label for="player-class">🏰 Your Guild:</label>
                <input type="text" id="player-class" placeholder="e.g., 9A Knights, 9B Mages..." maxlength="10">
            </div>
            <div class="form-group">
                <label>⚔️ Choose Your Quest Difficulty:</label>
                <div class="difficulty-selection">
                    <div class="difficulty-option active" data-difficulty="easy" onclick="selectDifficulty('easy', this)">
                        <div class="difficulty-icon">🛡️</div>
                        <div class="difficulty-name">Novice</div>
                        <div class="difficulty-time">60 seconds</div>
                        <div class="difficulty-desc">Simple words, more time</div>
                    </div>
                    <div class="difficulty-option" data-difficulty="medium" onclick="selectDifficulty('medium', this)">
                        <div class="difficulty-icon">⚔️</div>
                        <div class="difficulty-name">Warrior</div>
                        <div class="difficulty-time">40 seconds</div>
                        <div class="difficulty-desc">Standard challenge</div>
                    </div>
                    <div class="difficulty-option" data-difficulty="hard" onclick="selectDifficulty('hard', this)">
                        <div class="difficulty-icon">🔥</div>
                        <div class="difficulty-name">Champion</div>
                        <div class="difficulty-time">25 seconds</div>
                        <div class="difficulty-desc">Advanced vocabulary</div>
                    </div>
                    <div class="difficulty-option" data-difficulty="expert" onclick="selectDifficulty('expert', this)">
                        <div class="difficulty-icon">💀</div>
                        <div class="difficulty-name">Legendary</div>
                        <div class="difficulty-time">18 seconds</div>
                        <div class="difficulty-desc">Ultimate challenge</div>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label>Choose Your Hero:</label>
                <div class="hero-selection">
                    <div class="hero-option active" data-hero="mage" onclick="selectHero('mage', this)">
                        <div class="hero-avatar-large">
                            <img src="https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/s033zstpp7ltcqmni43p9a1exulo" alt="Mage" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
                        </div>
                        <div class="hero-name">Mage</div>
                    </div>
                    <div class="hero-option" data-hero="knight" onclick="selectHero('knight', this)">
                        <div class="hero-avatar-large">
                            <img src="https://imgproxy.attic.sh/insecure/f:webp/q:90/w:750/plain/https://attic.sh/jynm2aec3thbklvsnpnhnlv8nt8r" alt="Knight" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
                        </div>
                        <div class="hero-name">Knight</div>
                    </div>
                    <div class="hero-option" data-hero="sorcerer" onclick="selectHero('sorcerer', this)">
                        <div class="hero-avatar-large">
                            <img src="https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/udfx18jhc3bfg5y1t2pb9rlpd3pd" alt="Sorcerer" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
                        </div>
                        <div class="hero-name">Sorcerer</div>
                    </div>
                    <div class="hero-option" data-hero="elf" onclick="selectHero('elf', this)">
                        <div class="hero-avatar-large">
                            <img src="https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/78o5mhr9assra860vgm4wm1tykcp" alt="Elf" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
                        </div>
                        <div class="hero-name">Elf</div>
                    </div>
                    <div class="hero-option" data-hero="fairy" onclick="selectHero('fairy', this)">
                        <div class="hero-avatar-large">
                            <img src="https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/n09ekeo9hcjntle9se9vwno4pfoj" alt="Fairy" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">
                        </div>
                        <div class="hero-name">Fairy</div>
                    </div>
                </div>
            </div>
            <button class="start-game-btn" id="start-game-btn" onclick="startGame()" disabled>
                ⚔️ Begin Your Quest!
            </button>
        </div>


    </div>

    <!-- Game Screen -->
    <div class="game-container game-screen" id="game-screen">
        <button class="back-home-btn" onclick="goHome()">🏠 Back to Home</button>
        
        <div class="player-header">
            <h3>Player: <span id="current-player-name">Unknown</span></h3>
            <p>Class: <span id="current-player-class">Unknown</span></p>
        </div>

        <div class="header">
            <h1>Vocabulary Match-Up Adventure</h1>
            <p>Match words to their meanings and defeat the monster!</p>
        </div>



        <div class="score-display">
            <h3>📊 Game Stats</h3>
            <div class="score-stats">
                <div class="stat-item">
                    <div class="stat-value" id="total-score">0</div>
                    <div>Score</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="streak-count">0</div>
                    <div>Streak</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="accuracy">100%</div>
                    <div>Accuracy</div>
                </div>
            </div>
        </div>

        <div class="game-stats">
            <div class="character-info">
                <div class="character-avatar" id="character-avatar">🧙‍♂️</div>
                <div class="level-info">
                    <h3>Level <span id="player-level">1</span> Hero</h3>
                    <div class="xp-bar">
                        <div class="xp-fill" id="xp-fill" style="width: 0%"></div>
                    </div>
                    <small><span id="current-xp">0</span> / <span id="max-xp">100</span> XP</small>
                </div>
            </div>

            <div class="timer-section">
                <div class="timer-circle" id="timer-circle">
                    <div class="timer-text" id="timer-text">30</div>
                    <div class="combo-display" id="combo-display">x2</div>
                </div>
                <small>Time Left</small>
            </div>

            <div class="monster-info">
                <div class="monster-avatar" id="monster-avatar">👹</div>
                <h4 id="monster-name">Vocabulary Demon</h4>
                <div class="hp-bar">
                    <div class="hp-fill" id="monster-hp" style="width: 100%"></div>
                </div>
                <small><span id="monster-hp-text">100</span> / 100 HP</small>
            </div>
        </div>

        <div class="power-ups">
            <button class="power-up-btn" id="hint-btn" onclick="useHint()">
                🔮 Oracle's Hint
                <div class="cooldown" id="hint-cooldown" style="width: 0%"></div>
            </button>
            <button class="power-up-btn" id="freeze-btn" onclick="freezeTime()">
                ❄️ Time Crystal
                <div class="cooldown" id="freeze-cooldown" style="width: 0%"></div>
            </button>
            <button class="power-up-btn" id="double-btn" onclick="doublePoints()">
                💎 Power Gem
                <div class="cooldown" id="double-cooldown" style="width: 0%"></div>
            </button>
        </div>

        <div class="feedback" id="feedback"></div>

        <div class="game-board">
            <div class="card-section">
                <h3>📚 Vocabulary Words</h3>
                <div class="cards-grid" id="word-cards"></div>
            </div>

            <div class="card-section">
                <h3>📖 Definitions</h3>
                <div class="cards-grid" id="definition-cards"></div>
            </div>
        </div>


    </div>

    <div class="victory-screen" id="victory-screen">
        <div class="victory-content">
            <h2>🎉 Victory! 🎉</h2>
            <p>You've defeated the Vocabulary Demon and mastered these Year 9 words!</p>
            <p>Final Level: <span id="final-level"></span></p>
            <p>Final Score: <span id="final-score"></span></p>
            <p id="rank-message"></p>
            

            
            <div style="margin: 20px 0;">
                <button class="play-again-btn" onclick="downloadResults('VICTORY')" style="background: linear-gradient(135deg, #56ab2f, #a8e6cf); margin-bottom: 10px;">📥 Download Results</button>
            </div>
            
            <button class="play-again-btn" onclick="restartGame()">Play Again! 🔄</button>
            <button class="play-again-btn" onclick="goHome()" style="background: linear-gradient(135deg, #667eea, #764ba2); margin-left: 10px;">🏠 Home</button>
        </div>
    </div>

    <div class="streak-display" id="streak-display">
        🔥 STREAK x<span id="streak-number">3</span>! 🔥
    </div>

    <!-- Screen flash removed for better user experience -->

    <!-- Countdown Timer -->
    <div class="countdown-overlay" id="countdown-overlay">
        <div class="countdown-display">
            <div class="countdown-number" id="countdown-number">3</div>
            <div class="countdown-subtitle">⚔️ Prepare for Battle! ⚔️</div>
        </div>
    </div>

    <!-- Boss Showdown Screen -->
    <div class="boss-showdown" id="boss-showdown">
        <div class="showdown-arena">
            <div class="showdown-title" id="showdown-title">BOSS BATTLE!</div>
            <div class="showdown-subtitle" id="showdown-subtitle">Round 2: Grammar Dragon Approaches!</div>
            
            <div class="vs-symbol">VS</div>
            
            <div class="combatants">
                <div class="hero-side">
                    <div class="hero-avatar" id="showdown-hero-avatar">🧙‍♂️</div>
                    <div class="character-name hero-name" id="showdown-hero-name">Hero Name</div>
                    <div class="character-stats hero-stats">
                        <div class="stat-line">⭐ Level <span id="showdown-hero-level">1</span></div>
                        <div class="stat-line">🏆 Score: <span id="showdown-hero-score">0</span></div>
                        <div class="stat-line">🔥 Streak: <span id="showdown-hero-streak">0</span></div>
                    </div>
                </div>
                
                <div class="boss-side">
                    <div class="boss-avatar" id="showdown-boss-avatar">👹</div>
                    <div class="character-name boss-name" id="showdown-boss-name">Vocabulary Demon</div>
                    <div class="character-stats boss-stats">
                        <div class="stat-line">💀 HP: <span id="showdown-boss-hp">100</span></div>
                        <div class="stat-line">⚔️ Round: <span id="showdown-round">1</span></div>
                        <div class="stat-line">📚 Words: <span id="showdown-word-count">4</span></div>
                    </div>
                </div>
            </div>
            
            <div class="energy-waves">
                <div class="energy-wave"></div>
                <div class="energy-wave"></div>
                <div class="energy-wave"></div>
            </div>
            
            <button class="continue-btn" id="showdown-continue" onclick="hideShowdown()">⚔️ Begin Battle!</button>
        </div>
    </div>

    <!-- Boss Defeat Victory Screen -->
    <div class="boss-defeat-screen" id="boss-defeat-screen">
        <div class="defeat-arena">
            <div class="defeat-title" id="defeat-title">🏆 VICTORY! 🏆</div>
            <div class="defeat-subtitle" id="defeat-subtitle">The Vocabulary Demon has been vanquished!</div>
            
            <div class="defeat-combatants">
                <div class="victorious-hero">
                    <div class="victorious-hero-avatar" id="victory-hero-avatar">🧙‍♂️</div>
                    <div class="character-name hero-name" id="victory-hero-name">Hero Name</div>
                    <div class="character-stats hero-stats">
                        <div class="stat-line">⭐ Level <span id="victory-hero-level">1</span></div>
                        <div class="stat-line">🏆 Score: <span id="victory-hero-score">0</span></div>
                        <div class="stat-line">🔥 Streak: <span id="victory-hero-streak">0</span></div>
                    </div>
                </div>
                
                <div class="defeated-boss">
                    <div class="defeated-boss-avatar" id="victory-boss-avatar">👹</div>
                    <div class="character-name boss-name" id="victory-boss-name">Vocabulary Demon</div>
                    <div class="character-stats boss-stats" style="opacity: 0.5;">
                        <div class="stat-line">💀 DEFEATED</div>
                        <div class="stat-line">⚔️ Round: <span id="victory-round">1</span></div>
                        <div class="stat-line">📚 Words Mastered!</div>
                    </div>
                </div>
            </div>
            
            <div class="victory-effects">
                <div class="victory-wave"></div>
                <div class="victory-wave"></div>
                <div class="victory-wave"></div>
            </div>
            
            <button class="continue-victory-btn" id="victory-continue" onclick="hideBossDefeat()">⚔️ Continue Quest!</button>
        </div>
    </div>

    <script>
        // Game state
        let gameState = {
            playerLevel: 1,
            currentXP: 0,
            maxXP: 100,
            monsterHP: 100,
            maxMonsterHP: 100,
            selectedWord: null,
            selectedDefinition: null,
            currentRound: 1,
            matchesThisRound: 0,
            totalMatches: 0,
            difficulty: 'easy',
            timeLeft: 30,
            maxTime: 30,
            timerInterval: null,
            score: 0,
            streak: 0,
            maxStreak: 0,
            totalAttempts: 0,
            correctAttempts: 0,
            powerUps: {
                hint: { cooldown: 0, maxCooldown: 3 },
                freeze: { cooldown: 0, maxCooldown: 5 },
                double: { cooldown: 0, maxCooldown: 4 }
            },
            multiplier: 1,
            freezeActive: false,
            doubleActive: false
        };

        // Year 9 Brunei-appropriate vocabulary words with definitions - organized by difficulty
        const vocabularyData = {
            easy: [
                // Round 1 - Apprentice Level (4 words) - Basic descriptive words
                [
                    { word: "Diligent", definition: "Working hard with care and effort" },
                    { word: "Respectful", definition: "Showing politeness and consideration for others" },
                    { word: "Harmonious", definition: "Living together peacefully without conflict" },
                    { word: "Prosperous", definition: "Successful and doing well financially" }
                ],
                // Round 2 - Novice Level (5 words) - Character and values
                [
                    { word: "Courteous", definition: "Polite and showing good manners" },
                    { word: "Tolerant", definition: "Accepting different opinions and beliefs" },
                    { word: "Disciplined", definition: "Having self-control and following rules" },
                    { word: "Compassionate", definition: "Showing kindness and concern for others" },
                    { word: "Modest", definition: "Not boasting about achievements; humble" }
                ],
                // Round 3 - Warrior Level (6 words) - Academic and social terms
                [
                    { word: "Multicultural", definition: "Including people from many different cultures" },
                    { word: "Traditional", definition: "Following customs passed down through generations" },
                    { word: "Contemporary", definition: "Belonging to the present time; modern" },
                    { word: "Sustainable", definition: "Able to continue without harming the environment" },
                    { word: "Diverse", definition: "Showing variety; including different types" },
                    { word: "Heritage", definition: "Traditions and culture passed down from ancestors" }
                ],
                // Round 4 - Champion Level (7 words) - Advanced concepts
                [
                    { word: "Collaborate", definition: "To work together with others on a project" },
                    { word: "Advocate", definition: "To publicly support or recommend something" },
                    { word: "Integrity", definition: "Being honest and having strong moral principles" },
                    { word: "Initiative", definition: "The ability to start things independently" },
                    { word: "Perseverance", definition: "Continuing to try despite difficulties" },
                    { word: "Eloquent", definition: "Speaking or writing in a clear, persuasive way" },
                    { word: "Diplomatic", definition: "Skilled at handling sensitive situations tactfully" }
                ],
                // Round 5 - Expert Level (8 words) - Complex vocabulary
                [
                    { word: "Exemplary", definition: "Serving as a perfect example to others" },
                    { word: "Meticulous", definition: "Showing great attention to detail" },
                    { word: "Pragmatic", definition: "Dealing with things in a practical, realistic way" },
                    { word: "Articulate", definition: "Able to express thoughts clearly and effectively" },
                    { word: "Conscientious", definition: "Wishing to do what is right and proper" },
                    { word: "Innovative", definition: "Introducing new ideas or methods" },
                    { word: "Resilient", definition: "Able to recover quickly from setbacks" },
                    { word: "Versatile", definition: "Able to adapt to many different functions" }
                ],
                // Round 6 - FINAL BOSS BATTLE (10 words) - Sophisticated academic vocabulary
                [
                    { word: "Philanthropic", definition: "Seeking to help others, especially through charity" },
                    { word: "Magnanimous", definition: "Very generous and forgiving towards others" },
                    { word: "Judicious", definition: "Having good judgment; wise and careful" },
                    { word: "Tenacious", definition: "Very determined; not giving up easily" },
                    { word: "Altruistic", definition: "Caring about others' welfare more than your own" },
                    { word: "Astute", definition: "Having sharp intelligence and good judgment" },
                    { word: "Benevolent", definition: "Kind and generous in helping others" },
                    { word: "Discerning", definition: "Showing good judgment and understanding" },
                    { word: "Prudent", definition: "Acting with careful thought for the future" },
                    { word: "Sagacious", definition: "Having deep wisdom and good judgment" }
                ]
            ],
            medium: [
                // Round 1 - Apprentice Level (4 words) - Social and cultural terms
                [
                    { word: "Sovereignty", definition: "The authority of a state to govern itself" },
                    { word: "Democracy", definition: "A system where people choose their leaders by voting" },
                    { word: "Constitution", definition: "The basic laws that govern a country" },
                    { word: "Citizenship", definition: "The status of being a member of a country" }
                ],
                // Round 2 - Novice Level (5 words) - Academic and social concepts
                [
                    { word: "Globalization", definition: "The process of countries becoming more connected" },
                    { word: "Infrastructure", definition: "Basic facilities like roads, schools, and hospitals" },
                    { word: "Entrepreneur", definition: "A person who starts and runs their own business" },
                    { word: "Sustainable", definition: "Able to continue without harming the environment" },
                    { word: "Biodiversity", definition: "The variety of plant and animal life in an area" }
                ],
                // Round 3 - Warrior Level (6 words) - Advanced social studies
                [
                    { word: "Monarchy", definition: "A system of government ruled by a king or queen" },
                    { word: "Parliament", definition: "The group of people who make laws for a country" },
                    { word: "Legislation", definition: "Laws made by a government or parliament" },
                    { word: "Bureaucracy", definition: "The system of government departments and offices" },
                    { word: "Diplomacy", definition: "Managing relationships between countries peacefully" },
                    { word: "Prosperity", definition: "The state of being successful and wealthy" }
                ],
                // Round 4 - Champion Level (7 words) - Complex concepts
                [
                    { word: "Assimilate", definition: "To absorb and integrate into a larger group" },
                    { word: "Advocate", definition: "To publicly support or speak in favor of something" },
                    { word: "Collaborate", definition: "To work together with others towards a common goal" },
                    { word: "Commemorate", definition: "To honor the memory of someone or something" },
                    { word: "Consolidate", definition: "To combine things to make them stronger or more effective" },
                    { word: "Cultivate", definition: "To develop or improve something through care and effort" },
                    { word: "Facilitate", definition: "To make something easier or help bring about" }
                ],
                // Round 5 - Expert Level (8 words) - Sophisticated vocabulary
                [
                    { word: "Autonomous", definition: "Having the freedom to govern itself or make its own decisions" },
                    { word: "Comprehensive", definition: "Complete and including everything that is necessary" },
                    { word: "Deteriorate", definition: "To become progressively worse in quality or condition" },
                    { word: "Implement", definition: "To put a decision or plan into effect" },
                    { word: "Inevitable", definition: "Certain to happen; unavoidable" },
                    { word: "Legitimate", definition: "Conforming to the law or rules; valid" },
                    { word: "Predominant", definition: "Present as the strongest or main element" },
                    { word: "Substantial", definition: "Of considerable importance, size, or worth" }
                ],
                // Round 6 - FINAL BOSS BATTLE (10 words) - Advanced academic terms
                [
                    { word: "Unprecedented", definition: "Never done or known before; without previous example" },
                    { word: "Quintessential", definition: "Representing the most perfect example of a quality" },
                    { word: "Meticulous", definition: "Showing great attention to detail; very careful and precise" },
                    { word: "Pragmatic", definition: "Dealing with things sensibly and realistically" },
                    { word: "Resilient", definition: "Able to withstand or recover quickly from difficult conditions" },
                    { word: "Versatile", definition: "Able to adapt or be adapted to many different functions" },
                    { word: "Conscientious", definition: "Wishing to do what is right, especially in work or duty" },
                    { word: "Exemplary", definition: "Serving as a desirable model; very good" },
                    { word: "Formidable", definition: "Inspiring fear or respect through being impressively powerful" },
                    { word: "Judicious", definition: "Having, showing, or done with good judgment" }
                ]
            ],
            hard: [
                // Round 1 - Apprentice Level (4 words) - Advanced government and society
                [
                    { word: "Bureaucracy", definition: "A system of government through departments and agencies" },
                    { word: "Legislation", definition: "Laws considered collectively or the process of making laws" },
                    { word: "Jurisdiction", definition: "The official power to make legal decisions and judgments" },
                    { word: "Sovereignty", definition: "Supreme power or authority over a territory" }
                ],
                // Round 2 - Novice Level (5 words) - Economic and social concepts
                [
                    { word: "Capitalism", definition: "An economic system based on private ownership and profit" },
                    { word: "Socialism", definition: "A system where the community owns and controls production" },
                    { word: "Inflation", definition: "A general increase in prices and fall in purchasing value" },
                    { word: "Recession", definition: "A period of temporary economic decline" },
                    { word: "Commodity", definition: "A raw material or primary agricultural product for trade" }
                ],
                // Round 3 - Warrior Level (6 words) - Advanced academic terms
                [
                    { word: "Hypothesis", definition: "A proposed explanation made on limited evidence" },
                    { word: "Methodology", definition: "A system of methods used in a particular study" },
                    { word: "Phenomenon", definition: "A fact or situation that is observed to exist" },
                    { word: "Correlation", definition: "A mutual relationship between two or more things" },
                    { word: "Synthesis", definition: "The combination of ideas to form a theory" },
                    { word: "Analysis", definition: "Detailed examination of elements or structure" }
                ],
                // Round 4 - Champion Level (7 words) - Complex social and political terms
                [
                    { word: "Hegemony", definition: "Leadership or dominance by one country over others" },
                    { word: "Ideology", definition: "A system of ideas and ideals forming political theory" },
                    { word: "Propaganda", definition: "Information used to promote a political cause" },
                    { word: "Totalitarian", definition: "Relating to a system requiring complete submission to authority" },
                    { word: "Authoritarian", definition: "Favoring strict obedience to authority at expense of freedom" },
                    { word: "Egalitarian", definition: "Believing in the principle that all people are equal" },
                    { word: "Libertarian", definition: "Believing in maximum individual freedom and minimal government" }
                ],
                // Round 5 - Expert Level (8 words) - Sophisticated academic vocabulary
                [
                    { word: "Paradigm", definition: "A typical example or pattern of something; a model" },
                    { word: "Empirical", definition: "Based on observation or experience rather than theory" },
                    { word: "Theoretical", definition: "Concerned with or involving theory rather than practical application" },
                    { word: "Conceptual", definition: "Relating to or based on mental concepts" },
                    { word: "Fundamental", definition: "Forming a necessary base or core; essential" },
                    { word: "Comprehensive", definition: "Complete and including everything necessary" },
                    { word: "Systematic", definition: "Done according to a fixed plan or system; methodical" },
                    { word: "Analytical", definition: "Relating to or using analysis or logical reasoning" }
                ],
                // Round 6 - FINAL BOSS BATTLE (10 words) - Extremely challenging vocabulary
                [
                    { word: "Epistemology", definition: "The theory of knowledge and how we acquire understanding" },
                    { word: "Metaphysical", definition: "Relating to the branch of philosophy dealing with existence" },
                    { word: "Dialectical", definition: "Relating to logical discussion of ideas and opinions" },
                    { word: "Phenomenology", definition: "The philosophical study of structures of experience" },
                    { word: "Ontological", definition: "Relating to the branch of philosophy dealing with being" },
                    { word: "Hermeneutics", definition: "The branch of knowledge dealing with interpretation" },
                    { word: "Jurisprudence", definition: "The theory or philosophy of law" },
                    { word: "Anthropology", definition: "The study of humankind in all aspects" },
                    { word: "Sociology", definition: "The study of society and social relationships" },
                    { word: "Psychology", definition: "The scientific study of mind and behavior" }
                ]
            ],
            expert: [
                // Round 1 - Apprentice Level (4 words) - Advanced philosophical terms
                [
                    { word: "Epistemology", definition: "The theory of knowledge and justified belief" },
                    { word: "Ontology", definition: "The philosophical study of the nature of being" },
                    { word: "Metaphysics", definition: "The branch of philosophy dealing with reality" },
                    { word: "Phenomenology", definition: "The philosophical study of consciousness and experience" }
                ],
                // Round 2 - Novice Level (5 words) - Complex academic concepts
                [
                    { word: "Hermeneutics", definition: "The theory and methodology of interpretation" },
                    { word: "Dialectical", definition: "Relating to logical discussion through reasoning" },
                    { word: "Empiricism", definition: "The theory that knowledge comes from sensory experience" },
                    { word: "Rationalism", definition: "The theory that reason is the source of knowledge" },
                    { word: "Pragmatism", definition: "An approach that evaluates theories by their practical consequences" }
                ],
                // Round 3 - Warrior Level (6 words) - Advanced scientific and social terms
                [
                    { word: "Paradigm", definition: "A framework containing basic assumptions and ways of thinking" },
                    { word: "Hypothesis", definition: "A supposition made as starting point for investigation" },
                    { word: "Methodology", definition: "A system of methods used in particular area of study" },
                    { word: "Correlation", definition: "A mutual relationship or connection between variables" },
                    { word: "Causation", definition: "The relationship between cause and effect" },
                    { word: "Variable", definition: "An element that can change or be changed in experiment" }
                ],
                // Round 4 - Champion Level (7 words) - Sophisticated political and social concepts
                [
                    { word: "Hegemony", definition: "Leadership or dominance especially by one state over others" },
                    { word: "Ideology", definition: "A system of ideas forming basis of economic or political theory" },
                    { word: "Totalitarian", definition: "Relating to centralized control over all aspects of life" },
                    { word: "Authoritarian", definition: "Favoring complete obedience to authority over personal freedom" },
                    { word: "Egalitarian", definition: "Believing in equality of all people" },
                    { word: "Libertarian", definition: "Advocating minimal state intervention in lives of citizens" },
                    { word: "Utilitarian", definition: "Designed to be useful rather than attractive" }
                ],
                // Round 5 - Expert Level (8 words) - Extremely advanced vocabulary
                [
                    { word: "Quintessential", definition: "Representing most perfect example of quality or class" },
                    { word: "Ubiquitous", definition: "Present appearing or found everywhere" },
                    { word: "Ephemeral", definition: "Lasting for very short time" },
                    { word: "Ineffable", definition: "Too great or extreme to be expressed in words" },
                    { word: "Serendipity", definition: "Occurrence of events by chance in happy way" },
                    { word: "Juxtaposition", definition: "Fact of two things being seen close together" },
                    { word: "Dichotomy", definition: "Division into two mutually exclusive groups" },
                    { word: "Paradox", definition: "Statement that contradicts itself but contains truth" }
                ],
                // Round 6 - FINAL BOSS BATTLE (10 words) - Ultimate academic challenge
                [
                    { word: "Perspicacious", definition: "Having keen insight and understanding; perceptive" },
                    { word: "Sagacious", definition: "Having or showing keen mental discernment and good judgment" },
                    { word: "Magnanimous", definition: "Very generous or forgiving especially toward rival or enemy" },
                    { word: "Munificent", definition: "Extremely generous; giving or given very liberally" },
                    { word: "Beneficent", definition: "Generous or doing good; charitable" },
                    { word: "Mellifluous", definition: "Sweet or musical; pleasant to hear" },
                    { word: "Grandiloquent", definition: "Pompous or extravagant in language style or manner" },
                    { word: "Circumlocution", definition: "Use of many words where fewer would do; evasive speech" },
                    { word: "Sesquipedalian", definition: "Given to using long words; characterized by long words" },
                    { word: "Pusillanimous", definition: "Showing lack of courage or determination; timid" }
                ]
            ]
        };

        // Player data
        let playerData = {
            name: '',
            class: '',
            hero: 'mage',
            difficulty: 'easy'
        };

        let currentVocabulary = [];
        let matchedPairs = [];

        // Difficulty settings
        const difficultySettings = {
            easy: { time: 60, xpMultiplier: 1, damage: 20, timePenalty: 3, hpPenalty: 5 },
            medium: { time: 40, xpMultiplier: 1.5, damage: 25, timePenalty: 5, hpPenalty: 8 },
            hard: { time: 25, xpMultiplier: 2, damage: 30, timePenalty: 7, hpPenalty: 12 },
            expert: { time: 18, xpMultiplier: 3, damage: 35, timePenalty: 10, hpPenalty: 15 }
        };

        // Notification system
        let notificationQueue = [];
        let currentNotification = null;
        let isProcessingNotification = false;

        // Enhanced Sound System with Hero Skill Audio
        let audioContext = null;
        let heroSoundEffects = {};

        function initAudioContext() {
            if (!audioContext) {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    loadHeroSoundEffects();
                } catch (error) {
                    console.log('Audio not available');
                }
            }
        }

        function loadHeroSoundEffects() {
            // Load hero-specific sound effects from Pixabay
            heroSoundEffects = {
                elf: 'https://cdn.pixabay.com/download/audio/2023/10/03/audio_d0b9a0c6c5.mp3?filename=whoosh-118248.mp3',
                fairy: 'https://cdn.pixabay.com/download/audio/2024/03/14/audio_1710435735.mp3?filename=sparkle-magic-242245.mp3',
                mage: 'https://cdn.pixabay.com/download/audio/2023/12/06/audio_89eb4bc7ca.mp3?filename=ice-attack-whoosh-190272.mp3',
                sorcerer: 'https://cdn.pixabay.com/download/audio/2024/08/26/audio_7262ba2c31.mp3?filename=lightning-7573.mp3',
                knight: 'https://cdn.pixabay.com/download/audio/2023/12/06/audio_3e52c36a5e.mp3?filename=sword-sound-2-185435.mp3'
            };
        }

        function playHeroSoundEffect(heroType) {
            try {
                if (heroSoundEffects[heroType]) {
                    const audio = new Audio(heroSoundEffects[heroType]);
                    audio.volume = 0.6;
                    audio.play().catch(error => {
                        console.log('Hero sound effect not available, using fallback');
                        playHeroSkillSound(heroType); // Fallback to synthesized sound
                    });
                } else {
                    playHeroSkillSound(heroType); // Fallback to synthesized sound
                }
            } catch (error) {
                console.log('Hero sound effect failed, using fallback');
                playHeroSkillSound(heroType); // Fallback to synthesized sound
            }
        }

        function playSound(frequency, duration, type = 'sine', volume = 0.3) {
            try {
                initAudioContext();
                if (!audioContext) return;
                
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                oscillator.type = type;
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(volume, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            } catch (error) {
                console.log('Sound not available');
            }
        }



        function playHitSound() {
            // Epic sword strike sound
            playSound(800, 0.15, 'square', 0.4);
            setTimeout(() => playSound(600, 0.2, 'triangle', 0.3), 50);
        }

        function playComboSound(streak) {
            // Epic combo sound with harmonics
            const baseFreq = 523.25; // C5
            const freq = baseFreq + (streak * 100);
            playSound(freq, 0.4, 'triangle', 0.35);
            setTimeout(() => playSound(freq * 1.5, 0.3, 'sine', 0.25), 100);
        }

        function playLevelUpSound() {
            // Epic level up fanfare
            const notes = [261.63, 329.63, 392, 523.25, 659.25]; // C-E-G-C-E
            notes.forEach((freq, index) => {
                setTimeout(() => {
                    playSound(freq, 0.4, 'triangle', 0.3);
                    playSound(freq * 2, 0.3, 'sine', 0.2); // Octave harmony
                }, index * 120);
            });
        }

        function playErrorSound() {
            // Dramatic failure sound
            playSound(150, 0.3, 'sawtooth', 0.3);
            setTimeout(() => playSound(100, 0.4, 'square', 0.25), 150);
        }

        function playPowerUpSound() {
            // Magical power-up sound
            playSound(440, 0.2, 'sine', 0.25);
            setTimeout(() => playSound(659.25, 0.2, 'triangle', 0.25), 80);
            setTimeout(() => playSound(880, 0.3, 'sine', 0.3), 160);
            setTimeout(() => playSound(1108.73, 0.4, 'triangle', 0.25), 240);
        }

        function playHeroSkillSound(heroType) {
            switch(heroType) {
                case 'knight':
                    // Epic sword slash with multiple strikes
                    playSound(1200, 0.15, 'square', 0.5);
                    setTimeout(() => playSound(900, 0.2, 'sawtooth', 0.4), 100);
                    setTimeout(() => playSound(1500, 0.25, 'triangle', 0.35), 200);
                    setTimeout(() => playSound(800, 0.3, 'square', 0.3), 350);
                    break;
                case 'elf':
                    // Arrow whistle and impact with nature magic
                    playSound(1500, 0.1, 'sine', 0.3);
                    setTimeout(() => playSound(1200, 0.15, 'triangle', 0.35), 80);
                    setTimeout(() => playSound(800, 0.2, 'square', 0.4), 200);
                    setTimeout(() => playSound(600, 0.25, 'sawtooth', 0.3), 350);
                    break;
                case 'mage':
                    // Ice spell with crystalline resonance
                    playSound(400, 0.3, 'triangle', 0.3);
                    setTimeout(() => playSound(600, 0.25, 'sine', 0.35), 150);
                    setTimeout(() => playSound(900, 0.3, 'triangle', 0.3), 300);
                    setTimeout(() => playSound(1200, 0.4, 'sine', 0.25), 450);
                    setTimeout(() => playSound(1500, 0.2, 'triangle', 0.2), 600);
                    break;
                case 'sorcerer':
                    // Lightning storm with thunder
                    playSound(2000, 0.05, 'sawtooth', 0.4);
                    setTimeout(() => playSound(1500, 0.1, 'square', 0.45), 50);
                    setTimeout(() => playSound(1000, 0.15, 'sawtooth', 0.4), 120);
                    setTimeout(() => playSound(1800, 0.2, 'square', 0.35), 200);
                    setTimeout(() => playSound(1200, 0.3, 'sawtooth', 0.3), 350);
                    break;
                case 'fairy':
                    // Magical sparkles with ethereal chimes
                    playSound(1000, 0.2, 'sine', 0.3);
                    setTimeout(() => playSound(1200, 0.2, 'triangle', 0.3), 100);
                    setTimeout(() => playSound(1500, 0.25, 'sine', 0.35), 200);
                    setTimeout(() => playSound(1800, 0.2, 'triangle', 0.3), 300);
                    setTimeout(() => playSound(2000, 0.3, 'sine', 0.25), 400);
                    setTimeout(() => playSound(2400, 0.2, 'triangle', 0.2), 500);
                    break;
                default:
                    // Epic victory chord
                    playSound(523.25, 0.4, 'triangle', 0.3);
                    setTimeout(() => playSound(659.25, 0.4, 'sine', 0.3), 150);
                    setTimeout(() => playSound(783.99, 0.5, 'triangle', 0.35), 300);
            }
        }

        function playBossDefeatSound(heroType) {
            // Use the same epic skill sound for boss defeat
            playHeroSkillSound(heroType);
        }

        function playVictoryFanfare() {
            // Epic musical celebration
            const notes = [523.25, 659.25, 783.99, 1046.50]; // C-E-G-C (octave)
            notes.forEach((freq, index) => {
                setTimeout(() => {
                    playSound(freq, 0.6, 'sine', 0.3);
                    playSound(freq * 1.5, 0.6, 'triangle', 0.2); // Harmony
                }, index * 200);
            });
            
            // Add triumphant finale
            setTimeout(() => {
                playSound(1046.50, 1.0, 'sine', 0.35);
                playSound(1318.51, 1.0, 'triangle', 0.25);
            }, 800);
        }

        // Visual effects system (screen flash removed for better experience)

        function triggerElementAnimation(element, animationClass, duration = 1000) {
            // For monster avatar, use direct style animation instead of classes to maintain visibility
            if (element.id === 'monster-avatar' && (animationClass === 'monster-damage' || animationClass === 'critical-hit' || animationClass === 'power-up-activate')) {
                // Use direct style animation for monster to ensure it stays visible
                element.style.animation = `${animationClass} ${duration}ms ease-in-out`;
                setTimeout(() => {
                    element.style.animation = '';
                }, duration);
            } else {
                // Use class-based animation for other elements
                element.classList.add(animationClass);
                setTimeout(() => {
                    element.classList.remove(animationClass);
                }, duration);
            }
        }

        function createParticleEffect(x, y, color = '#feca57', count = 8) {
            for (let i = 0; i < count; i++) {
                const particle = document.createElement('div');
                particle.style.cssText = `
                    position: fixed;
                    left: ${x}px;
                    top: ${y}px;
                    width: 6px;
                    height: 6px;
                    background: ${color};
                    border-radius: 50%;
                    pointer-events: none;
                    z-index: 9999;
                    animation: particle-burst 0.8s ease-out forwards;
                `;
                
                // Random direction for each particle
                const angle = (i / count) * 360;
                const distance = 50 + Math.random() * 30;
                particle.style.setProperty('--angle', `${angle}deg`);
                particle.style.setProperty('--distance', `${distance}px`);
                
                document.body.appendChild(particle);
                
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, 800);
            }
        }

        function triggerBossDefeatAnimation() {
            const monsterAvatar = document.getElementById('monster-avatar');
            const heroType = playerData.hero;
            
            // Get monster position for effects
            const rect = monsterAvatar.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            // Play hero-specific sound effect FIRST (with fallback)
            playHeroSoundEffect(heroType);
            
            // Create hero-specific skill animation that travels to monster
            let skillTravelTime = 0;
            
            switch(heroType) {
                case 'knight':
                    skillTravelTime = 600; // Sword reaches monster in 600ms
                    // Create sword slash effect that travels across screen
                    const swordSlash = document.createElement('div');
                    swordSlash.style.cssText = `
                        position: fixed;
                        left: ${centerX - 300}px;
                        top: ${centerY - 10}px;
                        width: 600px;
                        height: 20px;
                        background: linear-gradient(90deg, transparent, #ffd700, #ffffff, #ffd700, transparent);
                        border-radius: 10px;
                        z-index: 9999;
                        animation: sword-slash-travel 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                        box-shadow: 0 0 30px #ffd700;
                        pointer-events: none;
                        transform: translateX(-100%);
                    `;
                    document.body.appendChild(swordSlash);
                    setTimeout(() => {
                        if (swordSlash.parentNode) swordSlash.parentNode.removeChild(swordSlash);
                    }, 800);
                    break;
                    
                case 'elf':
                    skillTravelTime = 500; // Arrow reaches monster in 500ms
                    // Create bigger arrow effect starting from middle of screen
                    const arrow = document.createElement('div');
                    arrow.style.cssText = `
                        position: fixed;
                        left: ${window.innerWidth / 2 - 50}px;
                        top: ${centerY - 5}px;
                        width: 100px;
                        height: 10px;
                        background: linear-gradient(90deg, #8B4513, #DAA520, #228B22);
                        border-radius: 5px;
                        z-index: 9999;
                        animation: epic-arrow-shot 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                        box-shadow: 0 0 20px #228B22;
                        pointer-events: none;
                    `;
                    
                    // Add bigger arrow tip
                    const arrowTip = document.createElement('div');
                    arrowTip.style.cssText = `
                        position: absolute;
                        right: -15px;
                        top: -7px;
                        width: 0;
                        height: 0;
                        border-left: 24px solid #DAA520;
                        border-top: 12px solid transparent;
                        border-bottom: 12px solid transparent;
                        filter: drop-shadow(0 0 8px #228B22);
                    `;
                    arrow.appendChild(arrowTip);
                    
                    document.body.appendChild(arrow);
                    setTimeout(() => {
                        if (arrow.parentNode) arrow.parentNode.removeChild(arrow);
                    }, 500);
                    break;
                    
                case 'mage':
                    skillTravelTime = 500; // Ice spell hits monster in 500ms
                    // Create ice spell effect with icicles
                    const iceSpell = document.createElement('div');
                    iceSpell.style.cssText = `
                        position: fixed;
                        left: ${centerX - 60}px;
                        top: ${centerY - 60}px;
                        width: 120px;
                        height: 120px;
                        background: radial-gradient(circle, #87CEEB, #4682B4, #191970);
                        border-radius: 50%;
                        z-index: 9999;
                        animation: epic-ice-spell 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                        box-shadow: 0 0 50px #87CEEB;
                        pointer-events: none;
                    `;
                    
                    // Add ice crystals/icicles around the spell
                    for(let i = 0; i < 8; i++) {
                        const icicle = document.createElement('div');
                        icicle.style.cssText = `
                            position: absolute;
                            width: 4px;
                            height: 20px;
                            background: linear-gradient(180deg, #FFFFFF, #87CEEB, #4682B4);
                            transform: rotate(${i * 45}deg) translateY(-40px);
                            border-radius: 2px 2px 0 0;
                            box-shadow: 0 0 8px #87CEEB;
                            animation: crystal-spin 0.8s ease-out;
                        `;
                        iceSpell.appendChild(icicle);
                    }
                    
                    document.body.appendChild(iceSpell);
                    setTimeout(() => {
                        if (iceSpell.parentNode) iceSpell.parentNode.removeChild(iceSpell);
                    }, 800);
                    break;
                    
                case 'sorcerer':
                    skillTravelTime = 400; // Lightning strikes monster in 400ms
                    // Create enhanced lightning effect
                    const lightning = document.createElement('div');
                    lightning.style.cssText = `
                        position: fixed;
                        left: ${centerX - 20}px;
                        top: ${centerY - 150}px;
                        width: 40px;
                        height: 150px;
                        background: linear-gradient(180deg, #FFD700, #FFFF00, #FF4500, #8B0000);
                        z-index: 9999;
                        animation: epic-lightning 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                        box-shadow: 0 0 60px #FFFF00;
                        clip-path: polygon(30% 0%, 70% 0%, 100% 25%, 60% 25%, 100% 50%, 40% 50%, 100% 75%, 60% 75%, 100% 100%, 30% 100%, 0% 75%, 40% 75%, 0% 50%, 60% 50%, 0% 25%, 40% 25%);
                        pointer-events: none;
                    `;
                    
                    // Add fire/burn particles
                    for(let i = 0; i < 6; i++) {
                        const flame = document.createElement('div');
                        flame.style.cssText = `
                            position: absolute;
                            width: 8px;
                            height: 8px;
                            background: radial-gradient(circle, #FFD700, #FF4500);
                            border-radius: 50%;
                            left: ${15 + i * 5}px;
                            top: ${120 + i * 10}px;
                            animation: sparkle-burst 0.6s ease-out ${i * 0.05}s;
                            box-shadow: 0 0 10px #FF4500;
                        `;
                        lightning.appendChild(flame);
                    }
                    
                    document.body.appendChild(lightning);
                    setTimeout(() => {
                        if (lightning.parentNode) lightning.parentNode.removeChild(lightning);
                    }, 600);
                    break;
                    
                case 'fairy':
                    skillTravelTime = 600; // Fairy magic hits monster in 600ms
                    // Create enhanced fairy magic effect
                    const fairyMagic = document.createElement('div');
                    fairyMagic.style.cssText = `
                        position: fixed;
                        left: ${centerX - 80}px;
                        top: ${centerY - 80}px;
                        width: 160px;
                        height: 160px;
                        background: radial-gradient(circle, #FFB6C1, #FF69B4, #FF1493);
                        border-radius: 50%;
                        z-index: 9999;
                        animation: epic-fairy-magic 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                        box-shadow: 0 0 80px #FF69B4;
                        pointer-events: none;
                    `;
                    
                    // Add sparkle particles
                    for(let i = 0; i < 16; i++) {
                        const sparkle = document.createElement('div');
                        sparkle.style.cssText = `
                            position: absolute;
                            width: 6px;
                            height: 6px;
                            background: radial-gradient(circle, #FFFFFF, #FFB6C1);
                            border-radius: 50%;
                            left: 50%;
                            top: 50%;
                            transform: rotate(${i * 22.5}deg) translateY(-60px);
                            box-shadow: 0 0 12px #FFFFFF;
                            animation: sparkle-burst 0.8s ease-out ${i * 0.02}s;
                        `;
                        fairyMagic.appendChild(sparkle);
                    }
                    
                    document.body.appendChild(fairyMagic);
                    setTimeout(() => {
                        if (fairyMagic.parentNode) fairyMagic.parentNode.removeChild(fairyMagic);
                    }, 800);
                    break;
                    
                default:
                    skillTravelTime = 500; // Default attack hits monster in 500ms
                    createParticleEffect(centerX, centerY, '#ffd700', 8);
            }
            
            // Monster gets hit AFTER skill reaches it (proper timing)
            setTimeout(() => {
                // Hero-specific monster defeat effects
                switch(heroType) {
                    case 'knight':
                        // Monster gets cut in half
                        monsterAvatar.style.animation = 'boss-cut-in-half 1.2s ease-out forwards';
                        createParticleEffect(centerX, centerY, '#ffd700', 12);
                        break;
                        
                    case 'elf':
                        // Monster tumbles backward from arrow impact
                        monsterAvatar.style.animation = 'boss-arrow-tumble 1.5s ease-out forwards';
                        createParticleEffect(centerX, centerY, '#228B22', 10);
                        break;
                        
                    case 'mage':
                        // Monster gets frozen with icicles
                        monsterAvatar.style.animation = 'boss-freeze-shatter 1.2s ease-out forwards';
                        
                        // Add icicle effects around monster
                        for(let i = 0; i < 6; i++) {
                            const icicle = document.createElement('div');
                            icicle.style.cssText = `
                                position: fixed;
                                left: ${centerX + (Math.cos(i * 60 * Math.PI / 180) * 50) - 2}px;
                                top: ${centerY + (Math.sin(i * 60 * Math.PI / 180) * 50) - 10}px;
                                width: 4px;
                                height: 20px;
                                background: linear-gradient(180deg, #FFFFFF, #87CEEB);
                                border-radius: 2px 2px 0 0;
                                z-index: 9998;
                                animation: crystal-spin 1.2s ease-out;
                                box-shadow: 0 0 8px #87CEEB;
                                pointer-events: none;
                            `;
                            document.body.appendChild(icicle);
                            setTimeout(() => {
                                if (icicle.parentNode) icicle.parentNode.removeChild(icicle);
                            }, 1200);
                        }
                        
                        createParticleEffect(centerX, centerY, '#87CEEB', 15);
                        break;
                        
                    case 'sorcerer':
                        // Monster burns and disintegrates
                        monsterAvatar.style.animation = 'boss-burn-effect 1.5s ease-out forwards';
                        createParticleEffect(centerX, centerY, '#FF4500', 20);
                        
                        // Add burning effect particles
                        setTimeout(() => createParticleEffect(centerX, centerY, '#FFD700', 15), 300);
                        setTimeout(() => createParticleEffect(centerX, centerY, '#FF0000', 10), 600);
                        break;
                        
                    case 'fairy':
                        // Monster sparkles and disappears
                        monsterAvatar.style.animation = 'boss-sparkle-fade 1.2s ease-out forwards';
                        createParticleEffect(centerX, centerY, '#FF69B4', 25);
                        
                        // Add continuous sparkle effects
                        setTimeout(() => createParticleEffect(centerX, centerY, '#FFFFFF', 20), 200);
                        setTimeout(() => createParticleEffect(centerX, centerY, '#FFB6C1', 15), 400);
                        setTimeout(() => createParticleEffect(centerX, centerY, '#FF1493', 10), 600);
                        break;
                        
                    default:
                        // Default monster damage animation
                        monsterAvatar.style.animation = 'monster-damage 0.6s ease-in-out';
                        createParticleEffect(centerX, centerY, '#ffd700', 8);
                        
                        setTimeout(() => {
                            monsterAvatar.style.animation = '';
                        }, 600);
                }
                
                // Play hit sound when attack connects
                playHitSound();
                
            }, skillTravelTime);
        }
        
        function showNotification(icon, title, message, type = 'success', duration = 3000) {
            // Prevent duplicate notifications
            const isDuplicate = notificationQueue.some(notification => 
                notification.title === title && notification.message === message
            );
            
            if (isDuplicate || (currentNotification && currentNotification.title === title)) {
                return;
            }
            
            // Add to queue
            notificationQueue.push({ icon, title, message, type, duration });
            
            // Process queue if not already processing
            if (!isProcessingNotification) {
                processNotificationQueue();
            }
        }
        
        function processNotificationQueue() {
            if (notificationQueue.length === 0 || isProcessingNotification) {
                if (notificationQueue.length === 0) {
                    currentNotification = null;
                    isProcessingNotification = false;
                }
                return;
            }
            
            isProcessingNotification = true;
            const { icon, title, message, type, duration } = notificationQueue.shift();
            
            // Remove any existing notifications immediately
            const existingNotifications = document.querySelectorAll('.notification-popup');
            existingNotifications.forEach(notification => {
                notification.remove();
            });
            
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification-popup ${type}`;
            notification.innerHTML = `
                <div class="notification-icon">${icon}</div>
                <div class="notification-title">${title}</div>
                <div class="notification-message">${message}</div>
            `;
            
            // Store reference for duplicate checking
            notification.title = title;
            notification.message = message;
            currentNotification = notification;
            
            document.body.appendChild(notification);
            
            // Show notification with animation
            requestAnimationFrame(() => {
                notification.classList.add('show');
            });
            
            // Hide notification after duration
            setTimeout(() => {
                if (notification && notification.parentNode) {
                    notification.classList.remove('show');
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                        currentNotification = null;
                        isProcessingNotification = false;
                        // Process next notification in queue with longer delay
                        setTimeout(() => processNotificationQueue(), 500);
                    }, 300);
                }
            }, duration);
        }

        // Initialize game
        function initGame() {
            // Use selected difficulty from player data
            const selectedDifficulty = playerData.difficulty;
            const timeLimit = difficultySettings[selectedDifficulty].time;
            
            // Reset to clean slate
            gameState = {
                playerLevel: 1,
                currentXP: 0,
                maxXP: 100,
                monsterHP: 100,
                maxMonsterHP: 100,
                selectedWord: null,
                selectedDefinition: null,
                currentRound: 1,
                matchesThisRound: 0,
                totalMatches: 0,
                difficulty: selectedDifficulty,
                timeLeft: timeLimit,
                maxTime: timeLimit,
                timerInterval: null,
                score: 0,
                streak: 0,
                maxStreak: 0,
                totalAttempts: 0,
                correctAttempts: 0,
                powerUps: {
                    hint: { cooldown: 0, maxCooldown: 3 },
                    freeze: { cooldown: 0, maxCooldown: 5 },
                    double: { cooldown: 0, maxCooldown: 4 }
                },
                multiplier: 1,
                freezeActive: false,
                doubleActive: false
            };
            
            // Reset monster appearance with image - ensure visibility
            const monsterImages = [
                'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:750/plain/https://attic.sh/3pdh6tatl2wx7h7vw5suwtdxvdil'
            ];
            const monsterAvatar = document.getElementById('monster-avatar');
            monsterAvatar.innerHTML = `<img src="${monsterImages[0]}" alt="Vocabulary Demon" style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">`;
            monsterAvatar.style.animation = ''; // Clear any existing animations
            monsterAvatar.style.opacity = '1'; // Ensure visibility
            monsterAvatar.style.display = 'flex'; // Ensure display
            document.getElementById('monster-name').textContent = 'Vocabulary Demon';
            
            // Reset power-up buttons
            document.querySelectorAll('.power-up-btn').forEach(btn => {
                btn.disabled = false;
                btn.querySelector('.cooldown').style.width = '0%';
            });
            
            // Update display first
            updateDisplay();
            
            // Load the first round
            loadRound();
        }



        function startTimer() {
            if (gameState.timerInterval) clearInterval(gameState.timerInterval);
            
            gameState.timerInterval = setInterval(() => {
                if (!gameState.freezeActive) {
                    gameState.timeLeft--;
                    updateTimerDisplay();
                    
                    if (gameState.timeLeft <= 0) {
                        timeUp();
                    }
                }
            }, 1000);
        }

        function timeUp() {
            clearInterval(gameState.timerInterval);
            gameState.timerInterval = null;
            gameState.streak = 0;
            
            // Show dramatic time up notification only once
            showNotification('⏳', 'TIME UP!', 'The hourglass runs empty!', 'error', 2000);
            
            // Time up is always instant game over
            setTimeout(() => {
                if (!document.getElementById('game-over-screen')) {
                    showGameOver();
                }
            }, 2500);
        }

        function updateTimerDisplay() {
            const timerText = document.getElementById('timer-text');
            const timerCircle = document.getElementById('timer-circle');
            
            timerText.textContent = gameState.timeLeft;
            
            const percentage = (gameState.timeLeft / gameState.maxTime) * 360;
            const color = gameState.timeLeft <= 5 ? '#ff4757' : gameState.timeLeft <= 10 ? '#feca57' : '#56ab2f';
            
            timerCircle.style.background = `conic-gradient(${color} ${percentage}deg, rgba(255,255,255,0.2) ${percentage}deg)`;
        }

        function loadRound() {
            const roundIndex = Math.min(gameState.currentRound - 1, vocabularyData[gameState.difficulty].length - 1);
            currentVocabulary = [...vocabularyData[gameState.difficulty][roundIndex]];
            matchedPairs = [];
            gameState.matchesThisRound = 0;
            gameState.timeLeft = difficultySettings[gameState.difficulty].time;
            gameState.maxTime = difficultySettings[gameState.difficulty].time;
            
            // Update display first
            updateDisplay();
            
            // Always show boss showdown first, then start the actual round
            showBossShowdown();
        }

        function renderCards(words, definitions) {
            const wordCardsContainer = document.getElementById('word-cards');
            const definitionCardsContainer = document.getElementById('definition-cards');
            
            wordCardsContainer.innerHTML = '';
            definitionCardsContainer.innerHTML = '';
            
            words.forEach((item, index) => {
                const wordCard = document.createElement('div');
                wordCard.className = 'card';
                wordCard.textContent = item.word;
                wordCard.onclick = () => selectWord(item.word, wordCard);
                wordCardsContainer.appendChild(wordCard);
            });
            
            definitions.forEach((item, index) => {
                const defCard = document.createElement('div');
                defCard.className = 'card';
                defCard.textContent = item.definition;
                defCard.onclick = () => selectDefinition(item.definition, defCard);
                definitionCardsContainer.appendChild(defCard);
            });
        }

        function selectWord(word, cardElement) {
            if (matchedPairs.some(pair => pair.word === word)) return;
            
            // Clear previous selections
            document.querySelectorAll('#word-cards .card').forEach(card => {
                card.classList.remove('selected', 'wrong');
            });
            
            gameState.selectedWord = word;
            cardElement.classList.add('selected');
            
            if (gameState.selectedDefinition) {
                checkMatch();
            }
        }

        function selectDefinition(definition, cardElement) {
            if (matchedPairs.some(pair => pair.definition === definition)) return;
            
            // Clear previous selections
            document.querySelectorAll('#definition-cards .card').forEach(card => {
                card.classList.remove('selected', 'wrong');
            });
            
            gameState.selectedDefinition = definition;
            cardElement.classList.add('selected');
            
            if (gameState.selectedWord) {
                checkMatch();
            }
        }

        function checkMatch() {
            const wordMatch = currentVocabulary.find(item => item.word === gameState.selectedWord);
            const isCorrect = wordMatch && wordMatch.definition === gameState.selectedDefinition;
            
            if (isCorrect) {
                handleCorrectMatch();
            } else {
                handleIncorrectMatch();
            }
        }

        function handleCorrectMatch() {
            // Hero-specific combat animations based on selected character
            const heroType = playerData.hero;
            let combatMessage = '';
            let particleColor = '#56ab2f';
            let particleCount = 6;
            
            // Customize combat based on hero type
            switch(heroType) {
                case 'mage':
                    combatMessage = '🔮 Your mystical spell strikes the beast!';
                    particleColor = '#667eea';
                    particleCount = 8;
                    break;
                case 'sorcerer':
                    combatMessage = '⚡ Dark magic courses through your enemy!';
                    particleColor = '#764ba2';
                    particleCount = 10;
                    break;
                case 'fairy':
                    combatMessage = '✨ Fairy magic sparkles with ancient power!';
                    particleColor = '#ff9ff3';
                    particleCount = 12;
                    break;
                case 'elf':
                    combatMessage = '🏹 Your enchanted arrow finds its mark!';
                    particleColor = '#56ab2f';
                    particleCount = 6;
                    break;
                case 'knight':
                    combatMessage = '⚔️ Your blade cuts deep into the darkness!';
                    particleColor = '#feca57';
                    particleCount = 8;
                    break;
                default:
                    combatMessage = '⚔️ Your attack strikes true!';
                    particleColor = '#56ab2f';
                    particleCount = 6;
            }
            
            // Mark cards as matched with enhanced animation
            const selectedCards = document.querySelectorAll('.card.selected');
            selectedCards.forEach(card => {
                card.classList.remove('selected');
                card.classList.add('matched');
                
                // Create hero-specific particle effect at card position
                const rect = card.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                createParticleEffect(centerX, centerY, particleColor, particleCount);
            });
            
            // Add to matched pairs
            matchedPairs.push({
                word: gameState.selectedWord,
                definition: gameState.selectedDefinition
            });
            
            // Update streak and scoring
            gameState.streak++;
            gameState.maxStreak = Math.max(gameState.maxStreak, gameState.streak);
            gameState.correctAttempts++;
            gameState.totalAttempts++;
            
            // Calculate score with multipliers
            const basePoints = 100;
            const timeBonus = Math.floor(gameState.timeLeft * 2);
            const streakBonus = gameState.streak >= 3 ? gameState.streak * 10 : 0;
            const difficultyMultiplier = difficultySettings[gameState.difficulty].xpMultiplier;
            const powerUpMultiplier = gameState.doubleActive ? 2 : 1;
            
            const points = Math.floor((basePoints + timeBonus + streakBonus) * difficultyMultiplier * powerUpMultiplier);
            gameState.score += points;
            
            // Update game state
            gameState.matchesThisRound++;
            gameState.totalMatches++;
            gameState.currentXP += Math.floor(25 * difficultyMultiplier);
            
            // Damage monster with epic animation
            const damage = difficultySettings[gameState.difficulty].damage;
            gameState.monsterHP = Math.max(0, gameState.monsterHP - damage);
            
            // Monster damage animation - KEEP MONSTER VISIBLE during gameplay
            const monsterAvatar = document.getElementById('monster-avatar');
            // Only apply temporary damage animation, never hide the monster during gameplay
            monsterAvatar.style.animation = 'monster-damage 0.6s ease-in-out';
            setTimeout(() => {
                // Reset animation but keep monster visible
                monsterAvatar.style.animation = '';
            }, 600);
            
            // Critical hit effect for high streaks
            if (gameState.streak >= 5) {
                // Apply critical hit animation but keep monster visible
                setTimeout(() => {
                    monsterAvatar.style.animation = 'critical-hit 0.8s ease-in-out';
                    setTimeout(() => {
                        monsterAvatar.style.animation = '';
                    }, 800);
                }, 700);
            }
            
            // Show streak display
            if (gameState.streak >= 3) {
                showStreakDisplay();
            }
            
            // Update combo display
            updateComboDisplay();
            
            // Check for level up
            if (gameState.currentXP >= gameState.maxXP) {
                levelUp();
            }
            
            // Show hero-specific feedback with enhanced styling
            const feedback = document.getElementById('feedback');
            feedback.textContent = `${combatMessage} +${points} points! ${gameState.streak > 1 ? `Combo x${gameState.streak}!` : ''}`;
            feedback.className = 'feedback success';
            
            // Add visual emphasis to feedback with sound effects
            triggerElementAnimation(feedback, 'epic-success', 800);
            
            // Play hit sound and combo sound if applicable
            playHitSound();
            if (gameState.streak >= 3) {
                setTimeout(() => playComboSound(gameState.streak), 200);
            }
            
            // Check if round is complete
            if (gameState.matchesThisRound === currentVocabulary.length) {
                clearInterval(gameState.timerInterval);
                
                // Always show boss defeat animation first
                triggerBossDefeatAnimation();
                
                // Show boss defeat screen immediately
                setTimeout(() => {
                    showBossDefeat();
                }, 1500);
            }
            
            // Reset selections
            gameState.selectedWord = null;
            gameState.selectedDefinition = null;
            
            updateDisplay();
        }

        function handleIncorrectMatch() {
            // Hero-specific failure messages
            const heroType = playerData.hero;
            let failureMessage = '';
            
            switch(heroType) {
                case 'mage':
                    failureMessage = '🔮 Your spell backfires! The magic turns against you!';
                    break;
                case 'sorcerer':
                    failureMessage = '⚡ Dark magic rebounds! The shadows mock your failure!';
                    break;
                case 'fairy':
                    failureMessage = '✨ Your fairy dust scatters uselessly in the wind!';
                    break;
                case 'elf':
                    failureMessage = '🏹 Your arrow misses its target completely!';
                    break;
                case 'knight':
                    failureMessage = '⚔️ Your blade strikes only air! The beast laughs!';
                    break;
                default:
                    failureMessage = '⚡ Your attack fails miserably!';
            }
            
            // Mark cards as wrong temporarily with enhanced shake
            const selectedCards = document.querySelectorAll('.card.selected');
            selectedCards.forEach(card => {
                card.classList.add('wrong');
                
                // Create red particle effect at card position
                const rect = card.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                createParticleEffect(centerX, centerY, '#ff4757', 8);
            });
            
            // Reset streak and update attempts
            gameState.streak = 0;
            gameState.totalAttempts++;
            
            // Apply penalties based on difficulty
            const settings = difficultySettings[gameState.difficulty];
            
            // Time penalty - ALWAYS applies
            gameState.timeLeft = Math.max(0, gameState.timeLeft - settings.timePenalty);
            
            // Monster heals (gets stronger) with healing animation - ALWAYS applies
            gameState.monsterHP = Math.min(gameState.maxMonsterHP, gameState.monsterHP + settings.hpPenalty);
            
            // Monster healing animation (reverse damage effect) - KEEP MONSTER VISIBLE
            const monsterAvatar = document.getElementById('monster-avatar');
            // Only apply temporary healing animation, never hide the monster during gameplay
            monsterAvatar.style.animation = 'power-up-activate 0.6s ease-in-out';
            setTimeout(() => {
                // Reset animation but keep monster visible
                monsterAvatar.style.animation = '';
            }, 600);
            
            // Show hero-specific feedback with penalty info and enhanced animation
            const feedback = document.getElementById('feedback');
            feedback.textContent = `${failureMessage} The beast grows stronger! (-${settings.timePenalty}s, +${settings.hpPenalty} HP)`;
            feedback.className = 'feedback error';
            
            // Play error sound
            playErrorSound();
            
            // Add dramatic shake to feedback
            triggerElementAnimation(feedback, 'shake', 1000);
            
            // Shake the entire game board for dramatic effect
            const gameBoard = document.querySelector('.game-board');
            if (gameBoard) {
                triggerElementAnimation(gameBoard, 'shake', 800);
            }
            
            // Check if time ran out due to penalty
            if (gameState.timeLeft <= 0) {
                setTimeout(() => timeUp(), 1000);
                return;
            }
            
            // Check if monster HP is now full and player is in final round - this could lead to failure
            if (gameState.currentRound === vocabularyData[gameState.difficulty].length && 
                gameState.monsterHP >= gameState.maxMonsterHP && 
                gameState.timeLeft <= 10) {
                // Player is in danger in final round - show warning
                setTimeout(() => {
                    const warningFeedback = document.getElementById('feedback');
                    warningFeedback.textContent = '💀 DANGER! The final boss is at full strength! Time is running out!';
                    warningFeedback.className = 'feedback error';
                }, 1500);
            }
            
            // Reset after animation
            setTimeout(() => {
                document.querySelectorAll('.card').forEach(card => {
                    card.classList.remove('selected', 'wrong');
                });
                gameState.selectedWord = null;
                gameState.selectedDefinition = null;
            }, 1000);
            
            updateDisplay();
        }

        // Power-up functions
        function useHint() {
            if (gameState.powerUps.hint.cooldown > 0) return;
            
            // Epic hint activation effects
            const hintBtn = document.getElementById('hint-btn');
            triggerElementAnimation(hintBtn, 'power-up-activate', 800);
            
            // Find an unmatched pair
            const unmatched = currentVocabulary.filter(item => 
                !matchedPairs.some(pair => pair.word === item.word)
            );
            
            if (unmatched.length > 0) {
                const hintItem = unmatched[0];
                
                // Highlight the word and definition with particle effects
                document.querySelectorAll('.card').forEach(card => {
                    if (card.textContent === hintItem.word || card.textContent === hintItem.definition) {
                        card.classList.add('hint');
                        
                        // Create magical particles around hint cards
                        const rect = card.getBoundingClientRect();
                        const centerX = rect.left + rect.width / 2;
                        const centerY = rect.top + rect.height / 2;
                        createParticleEffect(centerX, centerY, '#feca57', 6);
                        
                        setTimeout(() => card.classList.remove('hint'), 3000);
                    }
                });
                
                gameState.powerUps.hint.cooldown = gameState.powerUps.hint.maxCooldown;
                startCooldown('hint');
            }
        }

        function freezeTime() {
            if (gameState.powerUps.freeze.cooldown > 0) return;
            
            // Epic freeze activation effects
            const freezeBtn = document.getElementById('freeze-btn');
            triggerElementAnimation(freezeBtn, 'power-up-activate', 800);
            
            gameState.freezeActive = true;
            gameState.powerUps.freeze.cooldown = gameState.powerUps.freeze.maxCooldown;
            
            // Freeze effect on timer
            const timerCircle = document.getElementById('timer-circle');
            timerCircle.style.filter = 'hue-rotate(180deg) brightness(1.2)';
            
            const feedback = document.getElementById('feedback');
            feedback.textContent = '❄️ The Time Crystal halts the flow of eternity for 10 seconds!';
            feedback.className = 'feedback success';
            triggerElementAnimation(feedback, 'power-up-activate', 600);
            
            setTimeout(() => {
                gameState.freezeActive = false;
                timerCircle.style.filter = '';
            }, 10000);
            
            startCooldown('freeze');
            
            // Play level up sound
            playLevelUpSound();
        }

        function doublePoints() {
            if (gameState.powerUps.double.cooldown > 0) return;
            
            // Epic double points activation effects
            const doubleBtn = document.getElementById('double-btn');
            triggerElementAnimation(doubleBtn, 'power-up-activate', 800);
            
            gameState.doubleActive = true;
            gameState.powerUps.double.cooldown = gameState.powerUps.double.maxCooldown;
            
            // Visual indicator for double points
            const scoreDisplay = document.getElementById('total-score');
            scoreDisplay.style.filter = 'brightness(1.5) saturate(1.5)';
            
            const feedback = document.getElementById('feedback');
            feedback.textContent = '💎 The Power Gem amplifies your magical energy! Double rewards await!';
            feedback.className = 'feedback success';
            triggerElementAnimation(feedback, 'power-up-activate', 600);
            
            // Reset visual effect after 3 matches or timeout
            let doubleCount = 3;
            const checkDoubleActive = setInterval(() => {
                if (!gameState.doubleActive || doubleCount <= 0) {
                    scoreDisplay.style.filter = '';
                    clearInterval(checkDoubleActive);
                }
            }, 1000);
            
            startCooldown('double');
            
            // Play level up sound
            playLevelUpSound();
        }

        function startCooldown(powerUp) {
            const cooldownElement = document.getElementById(`${powerUp}-cooldown`);
            const button = document.getElementById(`${powerUp}-btn`);
            
            button.disabled = true;
            
            const cooldownInterval = setInterval(() => {
                gameState.powerUps[powerUp].cooldown--;
                const percentage = (gameState.powerUps[powerUp].cooldown / gameState.powerUps[powerUp].maxCooldown) * 100;
                cooldownElement.style.width = `${percentage}%`;
                
                if (gameState.powerUps[powerUp].cooldown <= 0) {
                    clearInterval(cooldownInterval);
                    button.disabled = false;
                    cooldownElement.style.width = '0%';
                }
            }, 1000);
        }

        function showStreakDisplay() {
            const streakDisplay = document.getElementById('streak-display');
            const streakNumber = document.getElementById('streak-number');
            
            streakNumber.textContent = gameState.streak;
            streakDisplay.classList.add('show');
            
            setTimeout(() => {
                streakDisplay.classList.remove('show');
            }, 2000);
        }

        function updateComboDisplay() {
            const comboDisplay = document.getElementById('combo-display');
            
            if (gameState.streak >= 2) {
                comboDisplay.textContent = `x${gameState.streak}`;
                comboDisplay.classList.add('active');
            } else {
                comboDisplay.classList.remove('active');
            }
        }

        function levelUp() {
            gameState.playerLevel++;
            gameState.currentXP = gameState.currentXP - gameState.maxXP;
            gameState.maxXP += 50; // Increase XP requirement
            
            // Epic level up effects without screen flash
            
            // Character avatar level up animation
            const characterAvatar = document.getElementById('character-avatar');
            triggerElementAnimation(characterAvatar, 'level-up-burst', 1200);
            
            // Create golden particles around character
            const avatarRect = characterAvatar.getBoundingClientRect();
            const avatarCenterX = avatarRect.left + avatarRect.width / 2;
            const avatarCenterY = avatarRect.top + avatarRect.height / 2;
            createParticleEffect(avatarCenterX, avatarCenterY, '#ffd700', 12);
            
            // Enhanced feedback with animation
            const feedback = document.getElementById('feedback');
            feedback.textContent = `⭐ Your power grows! You have ascended to Level ${gameState.playerLevel}!`;
            feedback.className = 'feedback success';
            triggerElementAnimation(feedback, 'level-up-burst', 1000);
            
            // Play level up sound
            playLevelUpSound();
        }

        function nextRound() {
            gameState.currentRound++;
            
            // Progressive monster strengthening - each round makes monster stronger
            const baseHP = 100;
            const hpIncrease = (gameState.currentRound - 1) * 25; // +25 HP per round
            gameState.maxMonsterHP = baseHP + hpIncrease;
            gameState.monsterHP = gameState.maxMonsterHP; // Full heal with increased max HP
            
            // Update monster appearance with images - ensure visibility
            const monsterImages = [
                'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:750/plain/https://attic.sh/3pdh6tatl2wx7h7vw5suwtdxvdil', // Demon
                'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/o3nf742331f8o189owg8z7lcrgpi', // Dragon
                'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:750/plain/https://attic.sh/d2w6g3yiihqr05ladwo4wksl4vqb', // Specter
                'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:750/plain/https://attic.sh/omahf9lnz00u47na30lilfip44vu', // Minotaur
                'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/qnenmyl66hyi8m01bf1u7kbjh8nt', // Lich
                'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:750/plain/https://attic.sh/ceo8y06y9st1n2bj5ahr4x2k0cmu'  // Ogre (Final Boss)
            ];
            const monsterNames = [
                'Vocabulary Demon', 
                'Grammar Dragon', 
                'Syntax Specter', 
                'Ancient Minotaur', 
                'Literature Lich',
                'FINAL OGRE BOSS'
            ];
            
            const monsterIndex = Math.min(gameState.currentRound - 1, monsterImages.length - 1);
            const monsterAvatar = document.getElementById('monster-avatar');
            monsterAvatar.innerHTML = `<img src="${monsterImages[monsterIndex]}" alt="${monsterNames[monsterIndex]}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">`;
            monsterAvatar.style.animation = ''; // Clear any existing animations
            monsterAvatar.style.opacity = '1'; // Ensure visibility
            monsterAvatar.style.display = 'flex'; // Ensure display
            document.getElementById('monster-name').textContent = monsterNames[monsterIndex];
            
            // Show epic boss showdown animation
            showBossShowdown();
        }

        function showBossShowdown() {
            // Stop any existing timer during showdown
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
                gameState.timerInterval = null;
            }
            
            const showdown = document.getElementById('boss-showdown');
            const monsterImages = [
                'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:750/plain/https://attic.sh/3pdh6tatl2wx7h7vw5suwtdxvdil', // Demon
                'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/o3nf742331f8o189owg8z7lcrgpi', // Dragon
                'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:750/plain/https://attic.sh/d2w6g3yiihqr05ladwo4wksl4vqb', // Specter
                'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:750/plain/https://attic.sh/omahf9lnz00u47na30lilfip44vu', // Minotaur
                'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/qnenmyl66hyi8m01bf1u7kbjh8nt', // Lich
                'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:750/plain/https://attic.sh/ceo8y06y9st1n2bj5ahr4x2k0cmu'  // Ogre (Final Boss)
            ];
            const monsterNames = [
                'Vocabulary Demon', 
                'Grammar Dragon', 
                'Syntax Specter', 
                'Ancient Minotaur', 
                'Literature Lich',
                'FINAL OGRE BOSS'
            ];
            
            const dungeonNames = [
                'The Cursed Library',
                'Dragon\'s Lair of Grammar',
                'Haunted Syntax Caverns',
                'Minotaur\'s Labyrinth',
                'Lich\'s Literature Tower',
                'THE ULTIMATE OGRE FORTRESS'
            ];
            
            const monsterIndex = Math.min(gameState.currentRound - 1, monsterImages.length - 1);
            
            // Update showdown display
            document.getElementById('showdown-title').textContent = 
                gameState.currentRound === 6 ? '💀 FINAL BOSS BATTLE! 💀' : '⚔️ BOSS BATTLE! ⚔️';
            
            document.getElementById('showdown-subtitle').textContent = 
                `Round ${gameState.currentRound}: ${dungeonNames[monsterIndex]}`;
            
            // Update hero stats with image
            const heroImages = {
                'mage': 'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/s033zstpp7ltcqmni43p9a1exulo',
                'knight': 'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:750/plain/https://attic.sh/jynm2aec3thbklvsnpnhnlv8nt8r',
                'sorcerer': 'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/udfx18jhc3bfg5y1t2pb9rlpd3pd',
                'elf': 'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/78o5mhr9assra860vgm4wm1tykcp',
                'fairy': 'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/n09ekeo9hcjntle9se9vwno4pfoj'
            };
            
            document.getElementById('showdown-hero-avatar').innerHTML = `<img src="${heroImages[playerData.hero]}" alt="${playerData.hero}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">`;
            document.getElementById('showdown-hero-name').textContent = playerData.name;
            document.getElementById('showdown-hero-level').textContent = gameState.playerLevel;
            document.getElementById('showdown-hero-score').textContent = gameState.score.toLocaleString();
            document.getElementById('showdown-hero-streak').textContent = gameState.streak;
            
            // Update boss stats with image
            document.getElementById('showdown-boss-avatar').innerHTML = `<img src="${monsterImages[monsterIndex]}" alt="${monsterNames[monsterIndex]}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">`;
            document.getElementById('showdown-boss-name').textContent = monsterNames[monsterIndex];
            document.getElementById('showdown-boss-hp').textContent = gameState.maxMonsterHP;
            document.getElementById('showdown-round').textContent = gameState.currentRound;
            document.getElementById('showdown-word-count').textContent = vocabularyData[gameState.difficulty][monsterIndex].length;
            
            // Show the showdown screen
            showdown.style.display = 'flex';
            
            // Play dramatic boss entrance sound
            if (gameState.currentRound === 6) {
                // Final boss special sound
                playSound(100, 0.5, 'sawtooth', 0.3);
                setTimeout(() => playSound(150, 0.5, 'square', 0.25), 500);
                setTimeout(() => playSound(200, 0.8, 'triangle', 0.2), 1000);
            } else {
                // Regular boss entrance sound
                playSound(200, 0.3, 'sawtooth', 0.25);
                setTimeout(() => playSound(300, 0.3, 'square', 0.2), 300);
                setTimeout(() => playSound(400, 0.4, 'triangle', 0.15), 600);
            }
            
            // Play dramatic sound effect (visual feedback)
            if (gameState.currentRound === 6) {
                // Final boss special effects
                document.querySelector('.showdown-arena').style.borderColor = '#ff4757';
                document.querySelector('.showdown-arena').style.boxShadow = 
                    '0 0 50px rgba(255, 71, 87, 0.8), inset 0 0 50px rgba(255, 71, 87, 0.2)';
            }
        }

        function hideShowdown() {
            document.getElementById('boss-showdown').style.display = 'none';
            
            // Start countdown timer before beginning the round
            startCountdown();
        }

        function showBossDefeat() {
            const defeatScreen = document.getElementById('boss-defeat-screen');
            
            // Get current monster info
            const monsterImages = [
                'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:750/plain/https://attic.sh/3pdh6tatl2wx7h7vw5suwtdxvdil', // Demon
                'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/o3nf742331f8o189owg8z7lcrgpi', // Dragon
                'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:750/plain/https://attic.sh/d2w6g3yiihqr05ladwo4wksl4vqb', // Specter
                'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:750/plain/https://attic.sh/omahf9lnz00u47na30lilfip44vu', // Minotaur
                'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/qnenmyl66hyi8m01bf1u7kbjh8nt', // Lich
                'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:750/plain/https://attic.sh/ceo8y06y9st1n2bj5ahr4x2k0cmu'  // Ogre (Final Boss)
            ];
            const monsterNames = [
                'Vocabulary Demon', 
                'Grammar Dragon', 
                'Syntax Specter', 
                'Ancient Minotaur', 
                'Literature Lich',
                'FINAL OGRE BOSS'
            ];
            
            const victoryMessages = [
                'The Vocabulary Demon crumbles before your linguistic might!',
                'The Grammar Dragon\'s flames are extinguished by your words!',
                'The Syntax Specter fades into the ethereal realm!',
                'The Ancient Minotaur bows to your superior vocabulary!',
                'The Literature Lich\'s dark magic is broken by your knowledge!',
                'THE FINAL OGRE BOSS IS VANQUISHED! YOU ARE THE ULTIMATE WORD MASTER!'
            ];
            
            const monsterIndex = Math.min(gameState.currentRound - 1, monsterImages.length - 1);
            
            // Update defeat screen content with notification message
            let notificationMessage = '';
            if (gameState.currentRound >= vocabularyData[gameState.difficulty].length) {
                // Final round completed - ALWAYS VICTORY regardless of monster HP!
                document.getElementById('defeat-title').textContent = '👑 LEGENDARY VICTORY! 👑';
                document.getElementById('defeat-subtitle').textContent = victoryMessages[monsterIndex];
                notificationMessage = '🎉 You have conquered all 6 dungeons and become a Word Master! 🎉';
            } else if (gameState.monsterHP <= 0) {
                // Monster defeated in earlier rounds
                document.getElementById('defeat-title').textContent = '🏆 BOSS DEFEATED! 🏆';
                document.getElementById('defeat-subtitle').textContent = victoryMessages[monsterIndex];
                notificationMessage = `⚔️ The ${document.getElementById('monster-name').textContent} has been defeated! Your words proved mightier than its dark magic!`;
            } else {
                // Round complete but monster still alive (not final round)
                document.getElementById('defeat-title').textContent = 'DUNGEON CLEARED!';
                document.getElementById('defeat-subtitle').textContent = victoryMessages[monsterIndex];
                notificationMessage = `📚 Dungeon vocabulary conquered! The ${document.getElementById('monster-name').textContent} retreats to fight another day!`;
            }
            
            // Notification removed as requested
            
            // Update hero stats with image
            const heroImages = {
                'mage': 'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/s033zstpp7ltcqmni43p9a1exulo',
                'knight': 'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:750/plain/https://attic.sh/jynm2aec3thbklvsnpnhnlv8nt8r',
                'sorcerer': 'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/udfx18jhc3bfg5y1t2pb9rlpd3pd',
                'elf': 'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/78o5mhr9assra860vgm4wm1tykcp',
                'fairy': 'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/n09ekeo9hcjntle9se9vwno4pfoj'
            };
            
            document.getElementById('victory-hero-avatar').innerHTML = `<img src="${heroImages[playerData.hero]}" alt="${playerData.hero}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 15px;" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">`;
            document.getElementById('victory-hero-name').textContent = playerData.name;
            document.getElementById('victory-hero-level').textContent = gameState.playerLevel;
            document.getElementById('victory-hero-score').textContent = gameState.score.toLocaleString();
            document.getElementById('victory-hero-streak').textContent = gameState.streak;
            
            // Update defeated boss with image
            document.getElementById('victory-boss-avatar').innerHTML = `<img src="${monsterImages[monsterIndex]}" alt="${monsterNames[monsterIndex]}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 15px;" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">`;
            document.getElementById('victory-boss-name').textContent = monsterNames[monsterIndex];
            document.getElementById('victory-round').textContent = gameState.currentRound;
            
            // Update button text based on final round
            const continueBtn = document.getElementById('victory-continue');
            if (gameState.currentRound >= vocabularyData[gameState.difficulty].length) {
                continueBtn.textContent = '👑 Claim Victory!';
            } else {
                continueBtn.textContent = '⚔️ Continue Quest!';
            }
            
            // Show the defeat screen
            defeatScreen.style.display = 'flex';
            
            // Create hero-specific skill animation on defeat screen with proper timing
            setTimeout(() => {
                const heroRect = document.getElementById('victory-hero-avatar').getBoundingClientRect();
                const heroCenterX = heroRect.left + heroRect.width / 2;
                const heroCenterY = heroRect.top + heroRect.height / 2;
                
                const bossRect = document.getElementById('victory-boss-avatar').getBoundingClientRect();
                const bossCenterX = bossRect.left + bossRect.width / 2;
                const bossCenterY = bossRect.top + bossRect.height / 2;
                
                // Calculate distance and angle between hero and boss
                const deltaX = bossCenterX - heroCenterX;
                const deltaY = bossCenterY - heroCenterY;
                const distance = Math.sqrt(deltaX * deltaX + deltaY * deltaY);
                
                // Create hero-specific skill animation that reaches the boss
                let skillElement;
                let skillTravelTime = 0; // Time for skill to reach boss
                const bossAvatar = document.getElementById('victory-boss-avatar');
                
                // Play hero skill sound FIRST
                playHeroSkillSound(playerData.hero);
                
                switch(playerData.hero) {
                    case 'knight':
                        skillTravelTime = 600; // Sword reaches boss in 600ms
                        // Epic sword slash that travels across screen (consistent with gameplay)
                        skillElement = document.createElement('div');
                        skillElement.style.cssText = `
                            position: fixed;
                            left: ${bossCenterX - 300}px;
                            top: ${bossCenterY - 10}px;
                            width: 600px;
                            height: 20px;
                            background: linear-gradient(90deg, transparent, #ffd700, #ffffff, #ffd700, transparent);
                            border-radius: 10px;
                            z-index: 9999;
                            animation: epic-sword-slash 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                            box-shadow: 0 0 30px #ffd700;
                        `;
                        
                        // Add screen slash effect
                        const slashEffect = document.createElement('div');
                        slashEffect.style.cssText = `
                            position: fixed;
                            top: 0;
                            left: 0;
                            width: 100%;
                            height: 100%;
                            background: linear-gradient(45deg, transparent 45%, rgba(255, 215, 0, 0.3) 50%, transparent 55%);
                            z-index: 9998;
                            pointer-events: none;
                            animation: screen-slash 0.3s ease-out;
                        `;
                        document.body.appendChild(slashEffect);
                        setTimeout(() => {
                            if (slashEffect.parentNode) slashEffect.parentNode.removeChild(slashEffect);
                        }, 300);
                        break;
                        
                    case 'elf':
                        skillTravelTime = 500; // Arrow reaches boss in 500ms
                        // Bigger arrow starting from middle of screen (consistent with gameplay)
                        skillElement = document.createElement('div');
                        skillElement.style.cssText = `
                            position: fixed;
                            left: ${window.innerWidth / 2 - 50}px;
                            top: ${bossCenterY - 5}px;
                            width: 100px;
                            height: 10px;
                            background: linear-gradient(90deg, #8B4513, #DAA520, #228B22);
                            border-radius: 5px;
                            z-index: 9999;
                            animation: epic-arrow-shot 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                            box-shadow: 0 0 20px #228B22;
                        `;
                        
                        // Add bigger arrow tip
                        const arrowTip = document.createElement('div');
                        arrowTip.style.cssText = `
                            position: absolute;
                            right: -15px;
                            top: -7px;
                            width: 0;
                            height: 0;
                            border-left: 24px solid #DAA520;
                            border-top: 12px solid transparent;
                            border-bottom: 12px solid transparent;
                            filter: drop-shadow(0 0 8px #228B22);
                        `;
                        skillElement.appendChild(arrowTip);
                        break;
                        
                    case 'mage':
                        skillTravelTime = 500; // Ice spell hits boss in 500ms
                        // Ice spell appears over boss (consistent with gameplay)
                        skillElement = document.createElement('div');
                        skillElement.style.cssText = `
                            position: fixed;
                            left: ${bossCenterX - 60}px;
                            top: ${bossCenterY - 60}px;
                            width: 120px;
                            height: 120px;
                            background: radial-gradient(circle, #87CEEB, #4682B4, #191970);
                            border-radius: 50%;
                            z-index: 9999;
                            animation: epic-ice-spell 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                            box-shadow: 0 0 50px #87CEEB;
                        `;
                        
                        // Add ice crystals
                        for(let i = 0; i < 8; i++) {
                            const crystal = document.createElement('div');
                            crystal.style.cssText = `
                                position: absolute;
                                width: 12px;
                                height: 12px;
                                background: linear-gradient(45deg, #87CEEB, #FFFFFF);
                                transform: rotate(${i * 45}deg) translateY(-40px);
                                border-radius: 3px;
                                box-shadow: 0 0 10px #87CEEB;
                                animation: crystal-spin 0.8s ease-out;
                            `;
                            skillElement.appendChild(crystal);
                        }
                        break;
                        
                    case 'sorcerer':
                        skillTravelTime = 400; // Lightning strikes boss in 400ms
                        // Lightning strikes boss from above (consistent with gameplay)
                        skillElement = document.createElement('div');
                        skillElement.style.cssText = `
                            position: fixed;
                            left: ${bossCenterX - 20}px;
                            top: ${bossCenterY - 150}px;
                            width: 40px;
                            height: 150px;
                            background: linear-gradient(180deg, #FFD700, #FFFF00, #9370DB, #4B0082);
                            z-index: 9999;
                            animation: epic-lightning 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                            box-shadow: 0 0 60px #FFFF00;
                            clip-path: polygon(30% 0%, 70% 0%, 100% 25%, 60% 25%, 100% 50%, 40% 50%, 100% 75%, 60% 75%, 100% 100%, 30% 100%, 0% 75%, 40% 75%, 0% 50%, 60% 50%, 0% 25%, 40% 25%);
                        `;
                        
                        // Add lightning branches
                        for(let i = 0; i < 3; i++) {
                            const branch = document.createElement('div');
                            branch.style.cssText = `
                                position: absolute;
                                width: 3px;
                                height: 60px;
                                background: linear-gradient(180deg, #FFFF00, #FFFFFF);
                                left: ${15 + i * 10}px;
                                top: ${30 + i * 40}px;
                                transform: rotate(${(i - 1) * 15}deg);
                                animation: lightning-branch 0.6s ease-out ${i * 0.05}s;
                                box-shadow: 0 0 8px #FFFF00;
                            `;
                            skillElement.appendChild(branch);
                        }
                        break;
                        
                    case 'fairy':
                        skillTravelTime = 600; // Fairy magic hits boss in 600ms
                        // Magical sparkles surround boss (consistent with gameplay)
                        skillElement = document.createElement('div');
                        skillElement.style.cssText = `
                            position: fixed;
                            left: ${bossCenterX - 80}px;
                            top: ${bossCenterY - 80}px;
                            width: 160px;
                            height: 160px;
                            background: radial-gradient(circle, #FFB6C1, #FF69B4, #FF1493);
                            border-radius: 50%;
                            z-index: 9999;
                            animation: epic-fairy-magic 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                            box-shadow: 0 0 80px #FF69B4;
                        `;
                        
                        // Add sparkle particles
                        for(let i = 0; i < 16; i++) {
                            const sparkle = document.createElement('div');
                            sparkle.style.cssText = `
                                position: absolute;
                                width: 8px;
                                height: 8px;
                                background: radial-gradient(circle, #FFFFFF, #FFB6C1);
                                border-radius: 50%;
                                left: 50%;
                                top: 50%;
                                transform: rotate(${i * 22.5}deg) translateY(-60px);
                                box-shadow: 0 0 12px #FFFFFF;
                                animation: sparkle-burst 0.8s ease-out ${i * 0.02}s;
                            `;
                            skillElement.appendChild(sparkle);
                        }
                        break;
                        
                    default:
                        skillTravelTime = 500; // Default energy blast hits boss in 500ms
                        // Default energy blast at boss
                        skillElement = document.createElement('div');
                        skillElement.style.cssText = `
                            position: fixed;
                            left: ${bossCenterX - 50}px;
                            top: ${bossCenterY - 50}px;
                            width: 100px;
                            height: 100px;
                            background: radial-gradient(circle, #ffd700, #ff6b6b);
                            border-radius: 50%;
                            z-index: 9999;
                            animation: epic-energy-blast 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                            box-shadow: 0 0 40px #ffd700;
                        `;
                }
                
                // Add skill element to screen
                if (skillElement) {
                    document.body.appendChild(skillElement);
                    
                    // Remove skill element after animation
                    setTimeout(() => {
                        if (skillElement.parentNode) {
                            skillElement.parentNode.removeChild(skillElement);
                        }
                    }, 1500);
                }
                
                // Boss gets hit AFTER skill reaches them (proper timing)
                setTimeout(() => {
                    switch(playerData.hero) {
                        case 'knight':
                            // Boss gets cut in half
                            bossAvatar.style.animation = 'boss-cut-in-half 1.2s ease-out forwards';
                            break;
                        case 'elf':
                            // Boss tumbles backward from arrow impact
                            bossAvatar.style.animation = 'boss-arrow-tumble 1.5s ease-out forwards';
                            break;
                        case 'mage':
                            // Boss gets frozen with icicles
                            bossAvatar.style.animation = 'boss-freeze-shatter 1.2s ease-out forwards';
                            
                            // Add icicle effects around boss
                            for(let i = 0; i < 6; i++) {
                                const icicle = document.createElement('div');
                                icicle.style.cssText = `
                                    position: fixed;
                                    left: ${bossCenterX + (Math.cos(i * 60 * Math.PI / 180) * 50) - 2}px;
                                    top: ${bossCenterY + (Math.sin(i * 60 * Math.PI / 180) * 50) - 10}px;
                                    width: 4px;
                                    height: 20px;
                                    background: linear-gradient(180deg, #FFFFFF, #87CEEB);
                                    border-radius: 2px 2px 0 0;
                                    z-index: 9998;
                                    animation: crystal-spin 1.2s ease-out;
                                    box-shadow: 0 0 8px #87CEEB;
                                    pointer-events: none;
                                `;
                                document.body.appendChild(icicle);
                                setTimeout(() => {
                                    if (icicle.parentNode) icicle.parentNode.removeChild(icicle);
                                }, 1200);
                            }
                            break;
                        case 'sorcerer':
                            // Boss burns and disintegrates
                            bossAvatar.style.animation = 'boss-burn-effect 1.5s ease-out forwards';
                            break;
                        case 'fairy':
                            // Boss sparkles and disappears
                            bossAvatar.style.animation = 'boss-sparkle-fade 1.2s ease-out forwards';
                            break;
                        default:
                            bossAvatar.style.animation = 'boss-defeated 1.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards';
                    }
                }, skillTravelTime);
                
                // Create victory particle effects
                createParticleEffect(heroCenterX, heroCenterY, '#ffd700', 20); // Gold burst
                setTimeout(() => createParticleEffect(heroCenterX, heroCenterY, '#56ab2f', 16), 300); // Victory green
                setTimeout(() => createParticleEffect(heroCenterX, heroCenterY, '#ffffff', 12), 600); // White sparkles
                
                // Boss defeat particles AFTER skill hits
                setTimeout(() => createParticleEffect(bossCenterX, bossCenterY, '#ff4757', 8), skillTravelTime + 100); // Red defeat
                setTimeout(() => createParticleEffect(bossCenterX, bossCenterY, '#666666', 6), skillTravelTime + 400); // Gray fade
                
            }, 500);
            
            // Play epic victory fanfare after skill sound and animation
            setTimeout(() => playVictoryFanfare(), 1500);
        }

        function hideBossDefeat() {
            document.getElementById('boss-defeat-screen').style.display = 'none';
            
            // Check if this was the final round
            if (gameState.currentRound >= vocabularyData[gameState.difficulty].length) {
                // Final victory - show main victory screen
                showVictory();
            } else {
                // Continue to next round
                nextRound();
            }
        }

        function startCountdown() {
            const countdownOverlay = document.getElementById('countdown-overlay');
            const countdownNumber = document.getElementById('countdown-number');
            
            countdownOverlay.style.display = 'flex';
            
            let count = 3;
            
            function updateCountdown() {
                if (count > 0) {
                    countdownNumber.textContent = count;
                    countdownNumber.className = 'countdown-number';
                    
                    // Trigger animation by forcing reflow
                    countdownNumber.offsetHeight;
                    
                    count--;
                    setTimeout(updateCountdown, 1000);
                } else {
                    // Show "GO!"
                    countdownNumber.textContent = 'GO!';
                    countdownNumber.className = 'countdown-go';
                    
                    // Hide countdown and start game after GO! animation
                    setTimeout(() => {
                        countdownOverlay.style.display = 'none';
                        startActualRound();
                    }, 1000);
                }
            }
            
            updateCountdown();
        }

        function startActualRound() {
            // Show round progression message
            const feedback = document.getElementById('feedback');
            if (gameState.currentRound === 1) {
                feedback.textContent = '🗡️ Your legendary quest begins! Channel ancient words into powerful spells!';
                feedback.className = 'feedback';
            } else if (gameState.currentRound === 6) {
                feedback.textContent = '💀 THE FINAL DARKNESS AWAITS! Face the ultimate linguistic challenge!';
                feedback.className = 'feedback error';
            } else {
                feedback.textContent = `⚔️ Dungeon ${gameState.currentRound}: The ancient evil grows stronger! (${gameState.maxMonsterHP} HP)`;
                feedback.className = 'feedback';
            }
            
            // Reset timer to full time before starting the round
            gameState.timeLeft = difficultySettings[gameState.difficulty].time;
            gameState.maxTime = difficultySettings[gameState.difficulty].time;
            
            // Start the actual round
            const roundIndex = Math.min(gameState.currentRound - 1, vocabularyData[gameState.difficulty].length - 1);
            currentVocabulary = [...vocabularyData[gameState.difficulty][roundIndex]];
            matchedPairs = [];
            gameState.matchesThisRound = 0;
            
            // Shuffle arrays
            const shuffledWords = [...currentVocabulary].sort(() => Math.random() - 0.5);
            const shuffledDefinitions = [...currentVocabulary].sort(() => Math.random() - 0.5);
            
            renderCards(shuffledWords, shuffledDefinitions);
            
            // Start timer only after countdown is complete
            startTimer();
            updateDisplay();
        }

        function showVictory() {
            clearInterval(gameState.timerInterval);
            
            // Play epic victory fanfare
            playVictoryFanfare();
            
            // Display final stats
            document.getElementById('final-level').textContent = gameState.playerLevel;
            document.getElementById('final-score').textContent = gameState.score.toLocaleString();
            document.getElementById('rank-message').innerHTML = '<strong style="color: #feca57;">🏆 Hail, Word Master! You have conquered all six dungeons and saved the realm!</strong>';
            document.getElementById('victory-screen').style.display = 'flex';
            
            // Try to automatically download results
            tryAutoDownload('VICTORY');
        }

        function showGameOver() {
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
                gameState.timerInterval = null;
            }
            
            // Check if game over screen already exists
            if (document.getElementById('game-over-screen')) {
                return;
            }
            
            // Show game over notification first
            showNotification('💀', 'QUEST FAILED!', 'The darkness claims another soul!', 'error', 2000);
            
            // Create game over screen after notification
            setTimeout(() => {
                // Double check to prevent duplicate screens
                if (document.getElementById('game-over-screen')) {
                    return;
                }
                
                const gameOverScreen = document.createElement('div');
                gameOverScreen.className = 'victory-screen';
                gameOverScreen.style.display = 'flex';
                gameOverScreen.id = 'game-over-screen';
            
            gameOverScreen.innerHTML = `
                <div class="victory-content" style="background: linear-gradient(135deg, #ff4757, #c44569);">
                    <h2>💀 Quest Failed! 💀</h2>
                    <p>The ancient evil has claimed another brave soul!</p>
                    <p>You reached Dungeon ${gameState.currentRound} of ${vocabularyData[gameState.difficulty].length}</p>
                    <p>Final Score: ${gameState.score.toLocaleString()}</p>
                    <p>Max Streak: ${gameState.maxStreak}</p>
                    <p>Accuracy: ${gameState.totalAttempts > 0 ? Math.round((gameState.correctAttempts / gameState.totalAttempts) * 100) : 100}%</p>
                    <p><strong style="color: #feca57;">⚔️ Train harder and return stronger, young warrior!</strong></p>
                    
                    <div style="margin: 20px 0;">
                        <button class="play-again-btn" onclick="downloadResults('GAME OVER')" style="background: linear-gradient(135deg, #56ab2f, #a8e6cf); margin-bottom: 10px;">📥 Download Results</button>
                    </div>
                    
                    <button class="play-again-btn" onclick="handleGameOverRestart()">Try Again! 🔄</button>
                    <button class="play-again-btn" onclick="handleGameOverHome()" style="background: linear-gradient(135deg, #667eea, #764ba2); margin-left: 10px;">🏠 Home</button>
                </div>
            `;
            
            // Visual game over effects only
            
            document.body.appendChild(gameOverScreen);
            
            // Try to automatically download results
            tryAutoDownload('GAME OVER');
            }, 2500);
        }

        function handleGameOverRestart() {
            // Remove game over screen
            const gameOverScreen = document.getElementById('game-over-screen');
            if (gameOverScreen) {
                gameOverScreen.remove();
            }
            
            // Call restart game
            restartGame();
        }

        function handleGameOverHome() {
            // Remove game over screen
            const gameOverScreen = document.getElementById('game-over-screen');
            if (gameOverScreen) {
                gameOverScreen.remove();
            }
            
            // Call go home
            goHome();
        }

        function restartGame() {
            if (gameState.timerInterval) clearInterval(gameState.timerInterval);
            
            gameState = {
                playerLevel: 1,
                currentXP: 0,
                maxXP: 100,
                monsterHP: 100,
                maxMonsterHP: 100,
                selectedWord: null,
                selectedDefinition: null,
                currentRound: 1,
                matchesThisRound: 0,
                totalMatches: 0,
                difficulty: 'easy',
                timeLeft: 30,
                maxTime: 30,
                timerInterval: null,
                score: 0,
                streak: 0,
                maxStreak: 0,
                totalAttempts: 0,
                correctAttempts: 0,
                powerUps: {
                    hint: { cooldown: 0, maxCooldown: 3 },
                    freeze: { cooldown: 0, maxCooldown: 5 },
                    double: { cooldown: 0, maxCooldown: 4 }
                },
                multiplier: 1,
                freezeActive: false,
                doubleActive: false
            };
            
            document.getElementById('victory-screen').style.display = 'none';
            // Reset monster appearance - ensure visibility
            const monsterAvatar = document.getElementById('monster-avatar');
            const monsterImages = [
                'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:750/plain/https://attic.sh/3pdh6tatl2wx7h7vw5suwtdxvdil'
            ];
            monsterAvatar.innerHTML = `<img src="${monsterImages[0]}" alt="Vocabulary Demon" style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">`;
            monsterAvatar.style.animation = ''; // Clear any existing animations
            monsterAvatar.style.opacity = '1'; // Ensure visibility
            monsterAvatar.style.display = 'flex'; // Ensure display
            document.getElementById('monster-name').textContent = 'Vocabulary Demon';
            
            // Reset difficulty selector
            document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.difficulty-btn').classList.add('active');
            
            // Reset power-up buttons
            document.querySelectorAll('.power-up-btn').forEach(btn => {
                btn.disabled = false;
                btn.querySelector('.cooldown').style.width = '0%';
            });
            
            initGame();
        }

        function updateDisplay() {
            // Player stats
            document.getElementById('player-level').textContent = gameState.playerLevel;
            document.getElementById('current-xp').textContent = gameState.currentXP;
            document.getElementById('max-xp').textContent = gameState.maxXP;
            document.getElementById('xp-fill').style.width = `${(gameState.currentXP / gameState.maxXP) * 100}%`;
            
            // Monster stats
            document.getElementById('monster-hp-text').textContent = gameState.monsterHP;
            document.getElementById('monster-hp').style.width = `${(gameState.monsterHP / gameState.maxMonsterHP) * 100}%`;
            
            // Score stats
            document.getElementById('total-score').textContent = gameState.score.toLocaleString();
            document.getElementById('streak-count').textContent = gameState.streak;
            
            // Accuracy calculation
            const accuracy = gameState.totalAttempts > 0 ? 
                Math.round((gameState.correctAttempts / gameState.totalAttempts) * 100) : 100;
            document.getElementById('accuracy').textContent = `${accuracy}%`;
            
            // Timer display
            updateTimerDisplay();
            updateComboDisplay();
        }

        // Homepage and scoreboard functions
        function selectDifficulty(difficulty, element) {
            // Remove active class from all difficulty options
            document.querySelectorAll('.difficulty-option').forEach(option => {
                option.classList.remove('active');
            });
            
            // Add active class to selected difficulty
            element.classList.add('active');
            
            // Update player data
            playerData.difficulty = difficulty;
            
            // Validate form after difficulty selection
            validatePlayerForm();
        }

        function selectHero(heroEmoji, element) {
            // Remove active class from all hero options
            document.querySelectorAll('.hero-option').forEach(option => {
                option.classList.remove('active');
            });
            
            // Add active class to selected hero
            element.classList.add('active');
            
            // Update player data
            playerData.hero = heroEmoji;
            
            // Validate form after hero selection
            validatePlayerForm();
        }

        function validatePlayerForm() {
            const name = document.getElementById('player-name').value.trim();
            const playerClass = document.getElementById('player-class').value.trim();
            const startBtn = document.getElementById('start-game-btn');
            
            if (name.length >= 2 && playerClass.length >= 2) {
                startBtn.disabled = false;
            } else {
                startBtn.disabled = true;
            }
        }

        function startGame() {
            const name = document.getElementById('player-name').value.trim();
            const playerClass = document.getElementById('player-class').value.trim();
            
            if (name.length < 2 || playerClass.length < 2) {
                showNotification('⚠️', 'Incomplete Registration!', 'Please enter both your name and class before starting!', 'warning');
                return;
            }
            
            playerData.name = name;
            playerData.class = playerClass;
            
            // Initialize audio context
            initAudioContext();
            
            // Switch to game screen first
            document.getElementById('homepage').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';
            
            // Update player display
            document.getElementById('current-player-name').textContent = name;
            document.getElementById('current-player-class').textContent = playerClass;
            
            // Update character avatar in game with image
            const heroImages = {
                'mage': 'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/s033zstpp7ltcqmni43p9a1exulo',
                'knight': 'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:750/plain/https://attic.sh/jynm2aec3thbklvsnpnhnlv8nt8r',
                'sorcerer': 'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/udfx18jhc3bfg5y1t2pb9rlpd3pd',
                'elf': 'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/78o5mhr9assra860vgm4wm1tykcp',
                'fairy': 'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/n09ekeo9hcjntle9se9vwno4pfoj'
            };
            document.getElementById('character-avatar').innerHTML = `<img src="${heroImages[playerData.hero]}" alt="${playerData.hero}" style="width: 100%; height: 100%; object-fit: cover;" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">`;
            
            // Set game difficulty from player selection
            gameState.difficulty = playerData.difficulty;
            gameState.timeLeft = difficultySettings[playerData.difficulty].time;
            gameState.maxTime = difficultySettings[playerData.difficulty].time;
            
            // Initialize game properly
            initGame();
        }

        function goHome() {
            // Stop any running timers
            if (gameState.timerInterval) clearInterval(gameState.timerInterval);
            

            
            // Reset game state
            gameState = {
                playerLevel: 1,
                currentXP: 0,
                maxXP: 100,
                monsterHP: 100,
                maxMonsterHP: 100,
                selectedWord: null,
                selectedDefinition: null,
                currentRound: 1,
                matchesThisRound: 0,
                totalMatches: 0,
                difficulty: 'easy',
                timeLeft: 30,
                maxTime: 30,
                timerInterval: null,
                score: 0,
                streak: 0,
                maxStreak: 0,
                totalAttempts: 0,
                correctAttempts: 0,
                powerUps: {
                    hint: { cooldown: 0, maxCooldown: 3 },
                    freeze: { cooldown: 0, maxCooldown: 5 },
                    double: { cooldown: 0, maxCooldown: 4 }
                },
                multiplier: 1,
                freezeActive: false,
                doubleActive: false
            };
            
            // Hide victory screen and game screen
            document.getElementById('victory-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('homepage').style.display = 'block';
            
            // Reset monster appearance - ensure visibility
            const monsterAvatar = document.getElementById('monster-avatar');
            const monsterImages = [
                'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:750/plain/https://attic.sh/3pdh6tatl2wx7h7vw5suwtdxvdil'
            ];
            monsterAvatar.innerHTML = `<img src="${monsterImages[0]}" alt="Vocabulary Demon" style="width: 100%; height: 100%; object-fit: cover; border-radius: 10px;" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">`;
            monsterAvatar.style.animation = ''; // Clear any existing animations
            monsterAvatar.style.opacity = '1'; // Ensure visibility
            monsterAvatar.style.display = 'flex'; // Ensure display
            document.getElementById('monster-name').textContent = 'Vocabulary Demon';
            
            // Reset character avatar to selected hero
            const heroImages = {
                'mage': 'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/s033zstpp7ltcqmni43p9a1exulo',
                'knight': 'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:750/plain/https://attic.sh/jynm2aec3thbklvsnpnhnlv8nt8r',
                'sorcerer': 'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/udfx18jhc3bfg5y1t2pb9rlpd3pd',
                'elf': 'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/78o5mhr9assra860vgm4wm1tykcp',
                'fairy': 'https://imgproxy.attic.sh/insecure/f:webp/q:90/w:828/plain/https://attic.sh/n09ekeo9hcjntle9se9vwno4pfoj'
            };
            document.getElementById('character-avatar').innerHTML = `<img src="${heroImages[playerData.hero]}" alt="${playerData.hero}" style="width: 100%; height: 100%; object-fit: cover;" onerror="this.src=''; this.alt='Image failed to load'; this.style.display='none';">`;
            
            // Reset difficulty selector
            document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.difficulty-btn').classList.add('active');
            
            // Reset power-up buttons
            document.querySelectorAll('.power-up-btn').forEach(btn => {
                btn.disabled = false;
                btn.querySelector('.cooldown').style.width = '0%';
            });
        }

        function downloadResults(gameStatus) {
            // Create comprehensive results report
            const currentDate = new Date().toLocaleDateString();
            const currentTime = new Date().toLocaleTimeString();
            
            const resultsText = `
🏰 VOCABULARY QUEST: REALM OF WORDS - GAME RESULTS 🐉
═══════════════════════════════════════════════════════

📅 Date: ${currentDate}
⏰ Time: ${currentTime}
🎮 Game Status: ${gameStatus}

👤 PLAYER INFORMATION
━━━━━━━━━━━━━━━━━━━━━
🧙‍♂️ Hero Name: ${playerData.name}
🏰 Guild: ${playerData.class}

📊 FINAL STATISTICS
━━━━━━━━━━━━━━━━━━━━━
🏆 Final Score: ${gameState.score.toLocaleString()} points
⭐ Level Reached: ${gameState.playerLevel}
🗡️ Dungeons Conquered: ${gameState.currentRound}/${vocabularyData[gameState.difficulty].length}
🔥 Max Streak: ${gameState.maxStreak}
🎯 Total Matches: ${gameState.totalMatches}
📈 Accuracy: ${gameState.totalAttempts > 0 ? Math.round((gameState.correctAttempts / gameState.totalAttempts) * 100) : 100}%
⚔️ Difficulty: ${gameState.difficulty.charAt(0).toUpperCase() + gameState.difficulty.slice(1)}

🏅 PERFORMANCE BREAKDOWN
━━━━━━━━━━━━━━━━━━━━━━━━━
✅ Correct Attempts: ${gameState.correctAttempts}
❌ Incorrect Attempts: ${gameState.totalAttempts - gameState.correctAttempts}
📝 Total Attempts: ${gameState.totalAttempts}
💪 Experience Gained: ${gameState.currentXP + (gameState.playerLevel - 1) * gameState.maxXP} XP

🎖️ ACHIEVEMENTS UNLOCKED
━━━━━━━━━━━━━━━━━━━━━━━━━━
${gameState.maxStreak >= 10 ? '🔥 Streak Master (10+ combo)\n' : ''}${gameState.playerLevel >= 5 ? '⭐ Level Champion (Reached Level 5+)\n' : ''}${gameState.totalMatches >= 30 ? '📚 Word Scholar (30+ matches)\n' : ''}${gameState.currentRound >= 6 ? '🏆 LEGENDARY WORD MASTER (Conquered All 6 Dungeons!)\n' : ''}${gameState.score >= 10000 ? '💎 Score Legend (10,000+ points)\n' : ''}${gameState.maxStreak < 10 && gameState.playerLevel < 5 && gameState.totalMatches < 30 && gameState.currentRound < 6 && gameState.score < 10000 ? 'Keep playing to unlock achievements!' : ''}

🏰 QUEST SUMMARY
━━━━━━━━━━━━━━━━━━━
${gameStatus === 'VICTORY' ? 
    '🎉 CONGRATULATIONS! You have successfully completed your quest and become a legendary Word Master! The realm of Lexiconia is forever in your debt!' : 
    `💀 Your quest ended at Round ${gameState.currentRound}. The vocabulary demons proved challenging, but your efforts were valiant! Train harder and return stronger!`}

📈 IMPROVEMENT SUGGESTIONS
━━━━━━━━━━━━━━━━━━━━━━━━━━━
${gameState.totalAttempts > 0 && (gameState.correctAttempts / gameState.totalAttempts) < 0.8 ? 
    '• Focus on accuracy - take time to read definitions carefully\n' : ''}${gameState.maxStreak < 5 ? 
    '• Work on building longer streaks for bonus points\n' : ''}${gameState.difficulty === 'easy' ? 
    '• Try higher difficulty levels for more points and XP\n' : ''}${gameState.totalAttempts > 0 && (gameState.correctAttempts / gameState.totalAttempts) >= 0.8 && gameState.maxStreak >= 5 && gameState.difficulty !== 'easy' ? 
    '• Excellent performance! You\'ve mastered the game mechanics!' : ''}

═══════════════════════════════════════════════════════
Generated by Vocabulary Quest: Realm of Words
Thank you for playing! 🗡️✨
═══════════════════════════════════════════════════════
            `.trim();
            
            try {
                // Create and trigger download
                const blob = new Blob([resultsText], { type: 'text/plain' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `VocabularyQuest_${playerData.name}_${currentDate.replace(/\//g, '-')}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
                
                // Show success message
                showDownloadMessage('📥 Results downloaded successfully!', 'success');
                
            } catch (error) {
                console.error('Download failed:', error);
                // Fallback: show results in a new window for manual copy
                const newWindow = window.open('', '_blank');
                newWindow.document.write(`<pre style="font-family: monospace; padding: 20px; white-space: pre-wrap;">${resultsText}</pre>`);
                newWindow.document.title = 'Vocabulary Quest Results';
                
                showDownloadMessage('📋 Results opened in new window - copy and save manually', 'error');
            }
        }

        function tryAutoDownload(gameStatus) {
            // Try automatic download, but don't show error if it fails
            try {
                downloadResults(gameStatus);
            } catch (error) {
                console.log('Auto-download failed, manual download available');
            }
        }

        function showDownloadMessage(message, type) {
            // Create temporary message element
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${type === 'success' ? 'rgba(86, 171, 47, 0.9)' : 'rgba(255, 71, 87, 0.9)'};
                color: white;
                padding: 15px 25px;
                border-radius: 25px;
                font-weight: bold;
                z-index: 10000;
                backdrop-filter: blur(10px);
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            `;
            messageDiv.textContent = message;
            
            document.body.appendChild(messageDiv);
            
            // Remove after 4 seconds
            setTimeout(() => {
                if (messageDiv.parentNode) {
                    messageDiv.parentNode.removeChild(messageDiv);
                }
            }, 4000);
        }

        function hideLandscapePrompt() {
            document.getElementById('landscape-prompt').style.display = 'none';
        }

        // Add event listeners for form validation
        document.addEventListener('DOMContentLoaded', function() {
            const nameInput = document.getElementById('player-name');
            const classInput = document.getElementById('player-class');
            
            nameInput.addEventListener('input', validatePlayerForm);
            classInput.addEventListener('input', validatePlayerForm);
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'96f1719f468dce17',t:'MTc1NTE4NDkwNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
